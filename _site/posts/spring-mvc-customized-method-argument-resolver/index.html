<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Spring Boot MVC 自定义参数解析器" />
<meta property="og:locale" content="en" />
<meta name="description" content="背景" />
<meta property="og:description" content="背景" />
<link rel="canonical" href="http://localhost:4000/posts/spring-mvc-customized-method-argument-resolver/" />
<meta property="og:url" content="http://localhost:4000/posts/spring-mvc-customized-method-argument-resolver/" />
<meta property="og:site_name" content="saveole" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-05-09T13:30:30+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Spring Boot MVC 自定义参数解析器" />
<meta name="twitter:site" content="@saveole" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-01-05T14:48:26+08:00","datePublished":"2023-05-09T13:30:30+08:00","description":"背景","headline":"Spring Boot MVC 自定义参数解析器","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/spring-mvc-customized-method-argument-resolver/"},"url":"http://localhost:4000/posts/spring-mvc-customized-method-argument-resolver/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Spring Boot MVC 自定义参数解析器 | saveole
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="saveole">
<meta name="application-name" content="saveole">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.27.20/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      let self = this;this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          self.clearMode();
        }
        self.notify();
      });

      if (!this.hasMode) {
        return;
      }

      if (this.isDarkMode) {
        this.setDark();
      } else {
        this.setLight();
      }
    }

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isPreferDark() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }get modeStatus() {
      if (this.hasMode) {
        return this.mode;
      } else {
        return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        this.clearMode();
      } else {
        if (this.isPreferDark) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    }
  }

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/avatar.jpeg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">saveole</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">Be Alive!</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/saveole"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/saveole"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['xgz.cz','foxmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Spring Boot MVC 自定义参数解析器</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Spring Boot MVC 自定义参数解析器</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1683610230"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  May  9, 2023
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1736059706"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jan  5, 2025
</time>

        </span>
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/saveole">saveole</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2962 words"
>
  <em>16 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  <div class="content">
    <h2 id="背景"><span class="me-2">背景</span><a href="#背景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">遗留系统</code>：</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>遗留接口系统为 Golang + Gin + MongoDB 实现, MongoDB collection 的 field 字段为中文名而且不固定<span class="o">(</span>可以通过 excel 文件自定义表头的形式添加<span class="o">)</span>, 查询参数是直接传的中文形式, 而且传参不固定<span class="o">(</span>query参数的 key 和 value 都不固定<span class="o">)</span>，如：/api/v1/customers?姓名<span class="o">=</span>张三&amp;录入时间<span class="o">=</span>2022-09-01 00:00:00&amp;录入时间<span class="o">=</span>2022-09-02 23:59:59
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">问题</code>：</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>go 工程师离职, 后端只有 java 工程师的情况下，将此接口改用 java 重写一遍，但传参方式不变<span class="o">(</span>query key 还是为中文<span class="o">)</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="实现"><span class="me-2">实现</span><a href="#实现" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="可选方案"><span class="me-2">可选方案</span><a href="#可选方案" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li><strong>方案一</strong>：不用 java 改写，java 工程师维护 golang 项目
    <ul>
      <li>优点：代码改动最小，出现 bug 的概率也最小</li>
      <li>缺点：需要花时间学习 go 语言和相关项目</li>
    </ul>
  </li>
  <li><strong>方案二</strong>：获取 HttpServletRequset 对象, 在相应的接口入口层进行参数处理
    <ul>
      <li>优点：能够获取到所有参数，快速实现功能</li>
      <li>缺点：针对特定接口实现，不利于代码扩展</li>
    </ul>
  </li>
  <li><strong>方案三</strong>：自定义 MVC 层参数解析器解析请求参数并绑定
    <ul>
      <li>优点：能够抽取此类需求的公共参数,结合反射和注解机制利于相似需求的扩展</li>
      <li>缺点：相对于方案二性能可能会差一点。
        <ul>
          <li>涉及到反射处理</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="方案三实现"><span class="me-2">方案三实现</span><a href="#方案三实现" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>MVC 方法参数处理器接口 <strong>HandlerMethodArgumentResolver</strong></li>
</ul>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HandlerMethodArgumentResolver</span> <span class="o">{</span>

	<span class="cm">/**
	 * 此解析器是否支持该方法参数的解析
	 */</span>
	<span class="kt">boolean</span> <span class="nf">supportsParameter</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">);</span>

	<span class="cm">/**
	 * 将拿到的原始数据解析成想要的参数对象
	 * A {@link ModelAndViewContainer} provides access to the model for the
	 * request. A {@link WebDataBinderFactory} provides a way to create
	 * a {@link WebDataBinder} instance when needed for data binding and
	 * type conversion purposes.
	 * @param parameter the method parameter to resolve. This parameter must
	 * have previously been passed to {@link #supportsParameter} which must
	 * have returned {@code true}.
	 * @param mavContainer the ModelAndViewContainer for the current request
	 * @param webRequest the current request
	 * @param binderFactory a factory for creating {@link WebDataBinder} instances
	 * @return the resolved argument value, or {@code null} if not resolvable
	 * @throws Exception in case of errors with the preparation of argument values
	 */</span>
	<span class="nd">@Nullable</span>
	<span class="nc">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span>
			<span class="nc">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

<span class="o">}</span>

</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>实现自定义方法参数处理器</li>
</ul>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
</pre></td><td class="rouge-code"><pre><span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ZhFieldRequestResolver</span> <span class="kd">implements</span> <span class="nc">HandlerMethodArgumentResolver</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supportsParameter</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 有 ZhBindConvertor 注解的参数才进行解析转换</span>
        <span class="k">return</span> <span class="n">parameter</span><span class="o">.</span><span class="na">hasParameterAnnotation</span><span class="o">(</span><span class="nc">ZhBindConvertor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="nc">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span>
                                  <span class="nc">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="nc">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">webRequest</span><span class="o">.</span><span class="na">getNativeRequest</span><span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">assert</span> <span class="n">request</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="c1">// 获取参数类型，根据参数类型反射创建类型实例</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">resultType</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">();</span>
        <span class="k">return</span> <span class="nf">buildResultObject</span><span class="o">(</span><span class="n">resultType</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Object</span> <span class="nf">buildResultObject</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">resultType</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InvocationTargetException</span><span class="o">,</span>
            <span class="nc">NoSuchMethodException</span><span class="o">,</span> <span class="nc">InstantiationException</span><span class="o">,</span> <span class="nc">IllegalAccessException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span>
        <span class="c1">// 根据不同的 http 方法，使用不同的参数构建模式</span>
        <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">method</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="s">"POST"</span> <span class="o">-&gt;</span> <span class="n">buildResultObjectForPost</span><span class="o">(</span><span class="n">resultType</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
            <span class="k">case</span> <span class="s">"GET"</span> <span class="o">-&gt;</span> <span class="n">buildResultObjectForGet</span><span class="o">(</span><span class="n">resultType</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
            <span class="k">default</span> <span class="o">-&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="s">"不支持的 http 方法类型: "</span> <span class="o">+</span> <span class="n">method</span><span class="o">);</span>
        <span class="o">};</span>
    <span class="o">}</span>

    <span class="cm">/**
     * GET 方法直接通过 {@link ServletRequest#getParameterMap()} 方法获取请求参数
     */</span>
    <span class="kd">private</span> <span class="nc">Object</span> <span class="nf">buildResultObjectForGet</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">resultType</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">NoSuchMethodException</span><span class="o">,</span>
            <span class="nc">InvocationTargetException</span><span class="o">,</span> <span class="nc">InstantiationException</span><span class="o">,</span> <span class="nc">IllegalAccessException</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">[]&gt;</span> <span class="n">parameterMap</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">pMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">parameterMap</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">pMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">v</span><span class="o">)));</span>
        <span class="nc">Field</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">resultType</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">();</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">superclass</span> <span class="o">=</span> <span class="n">resultType</span><span class="o">.</span><span class="na">getSuperclass</span><span class="o">();</span>
        <span class="nc">Field</span><span class="o">[]</span> <span class="n">superFields</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">superclass</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">Object</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">superFields</span> <span class="o">=</span> <span class="n">superclass</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">// 反射实例化参数对象        </span>
        <span class="nc">Object</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">resultType</span><span class="o">.</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="na">newInstance</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="c1">// 填充对象字段信息        </span>
        <span class="n">setFieldsForGet</span><span class="o">(</span><span class="n">fields</span><span class="o">,</span> <span class="n">instance</span><span class="o">,</span> <span class="n">parameterMap</span><span class="o">,</span> <span class="n">pMap</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">superFields</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setFieldsForGet</span><span class="o">(</span><span class="n">superFields</span><span class="o">,</span> <span class="n">instance</span><span class="o">,</span> <span class="n">parameterMap</span><span class="o">,</span> <span class="n">pMap</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 通过 field type 来设置对应的字段值
     * https://docs.oracle.com/javase/tutorial/reflect/member/fieldTypes.html
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setFieldsForGet</span><span class="o">(</span><span class="nc">Field</span><span class="o">[]</span> <span class="n">fields</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">instance</span><span class="o">,</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">[]&gt;</span> <span class="n">parameterMap</span><span class="o">,</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">pMap</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IllegalAccessException</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Field</span> <span class="n">f</span> <span class="o">:</span> <span class="n">fields</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">typeName</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getGenericType</span><span class="o">().</span><span class="na">getTypeName</span><span class="o">();</span>
            <span class="nc">ZhBindAlias</span> <span class="n">bindAlias</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">ZhBindAlias</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">nonNull</span><span class="o">(</span><span class="n">bindAlias</span><span class="o">))</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">bindAlias</span><span class="o">.</span><span class="na">value</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">bindAlias</span><span class="o">.</span><span class="na">index</span><span class="o">();</span>
                <span class="nc">String</span><span class="o">[]</span> <span class="n">values</span> <span class="o">=</span> <span class="n">parameterMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">values</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">values</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">Object</span> <span class="n">convertValue</span> <span class="o">=</span> <span class="nc">FieldTypeConvertor</span><span class="o">.</span><span class="na">FieldType</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">typeName</span><span class="o">).</span><span class="na">convert</span><span class="o">(</span><span class="n">values</span><span class="o">,</span> <span class="n">index</span><span class="o">);</span>
                    <span class="n">f</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">instance</span><span class="o">,</span> <span class="n">convertValue</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">pMap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="s">"extras"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pMap</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">f</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">instance</span><span class="o">,</span> <span class="n">pMap</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="nc">String</span><span class="o">[]</span> <span class="n">values</span> <span class="o">=</span> <span class="n">parameterMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">values</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">values</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">Object</span> <span class="n">convertValue</span> <span class="o">=</span> <span class="nc">FieldTypeConvertor</span><span class="o">.</span><span class="na">FieldType</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">typeName</span><span class="o">).</span><span class="na">convertFirst</span><span class="o">(</span><span class="n">values</span><span class="o">);</span>
                    <span class="n">f</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">instance</span><span class="o">,</span> <span class="n">convertValue</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">pMap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * POST 方法通过获取请求体 json 字符串转请求对象的方式获取参数信息
     */</span>
    <span class="kd">private</span> <span class="nc">Object</span> <span class="nf">buildResultObjectForPost</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">resultType</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">NoSuchMethodException</span><span class="o">,</span>
            <span class="nc">InvocationTargetException</span><span class="o">,</span> <span class="nc">InstantiationException</span><span class="o">,</span> <span class="nc">IllegalAccessException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">// 验证 header 的 Content-Type 为 application/json 才能进行后续操作</span>
        <span class="nc">String</span> <span class="n">contentTypeHeader</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="nc">HttpHeaders</span><span class="o">.</span><span class="na">CONTENT_TYPE</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">contentTypeHeader</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">contentTypeHeader</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_VALUE</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"请设置 Content-Type 值为 application/json"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">Field</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">resultType</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">();</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">superclass</span> <span class="o">=</span> <span class="n">resultType</span><span class="o">.</span><span class="na">getSuperclass</span><span class="o">();</span>
        <span class="nc">Field</span><span class="o">[]</span> <span class="n">superFields</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">superclass</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">Object</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">superFields</span> <span class="o">=</span> <span class="n">superclass</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">Object</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">resultType</span><span class="o">.</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="na">newInstance</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getReader</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">while</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">line</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"uri:{},请求体参数:{}"</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">(),</span> <span class="n">sb</span><span class="o">);</span>
            <span class="nc">JSONObject</span> <span class="n">body</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="na">parseObject</span><span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">setFields</span><span class="o">(</span><span class="n">fields</span><span class="o">,</span> <span class="n">body</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
            <span class="n">setFields</span><span class="o">(</span><span class="n">superFields</span><span class="o">,</span> <span class="n">body</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setFields</span><span class="o">(</span><span class="nc">Field</span><span class="o">[]</span> <span class="n">fields</span><span class="o">,</span> <span class="nc">JSONObject</span> <span class="n">source</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">target</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IllegalAccessException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">fields</span><span class="o">)</span> <span class="o">||</span> <span class="n">fields</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Field</span> <span class="n">f</span> <span class="o">:</span> <span class="n">fields</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">fName</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">typeName</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getGenericType</span><span class="o">().</span><span class="na">getTypeName</span><span class="o">();</span>
            <span class="nc">ZhBindAlias</span> <span class="n">bindAlias</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">ZhBindAlias</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">nonNull</span><span class="o">(</span><span class="n">bindAlias</span><span class="o">))</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">bindAlias</span><span class="o">.</span><span class="na">value</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">bindAlias</span><span class="o">.</span><span class="na">index</span><span class="o">();</span>
                <span class="nc">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="s">"extras"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">fName</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">f</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">jsonObjectToMap</span><span class="o">(</span><span class="n">source</span><span class="o">));</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">o</span><span class="o">))</span> <span class="k">continue</span><span class="o">;</span>
                <span class="nc">Object</span> <span class="n">convertValue</span> <span class="o">=</span> <span class="nc">FieldTypeConvertor</span><span class="o">.</span><span class="na">FieldType</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">typeName</span><span class="o">).</span><span class="na">convertJsonObject</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="n">index</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
                <span class="n">f</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">convertValue</span><span class="o">);</span>
                <span class="n">source</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="nc">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">fName</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">o</span><span class="o">))</span> <span class="k">continue</span><span class="o">;</span>
                <span class="nc">Object</span> <span class="n">convertValue</span> <span class="o">=</span> <span class="nc">FieldTypeConvertor</span><span class="o">.</span><span class="na">FieldType</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">typeName</span><span class="o">).</span><span class="na">convertJsonObject</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">fName</span><span class="o">);</span>
                <span class="n">f</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">convertValue</span><span class="o">);</span>
                <span class="n">source</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">fName</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="nf">jsonObjectToMap</span><span class="o">(</span><span class="nc">JSONObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">TypeReference</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">type</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TypeReference</span><span class="o">&lt;&gt;(){};</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">value</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">object</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="na">parseObject</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">type</span><span class="o">);</span>
            <span class="n">value</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
        <span class="o">});</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>配置 <strong>WebMvcConfigurer</strong> 使自定义参数解析器生效</li>
</ul>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addArgumentResolvers</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">HandlerMethodArgumentResolver</span><span class="o">&gt;</span> <span class="n">resolvers</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">resolvers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">ZhFieldRequestResolver</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>自定义注解用于标注解析后的参数接收类</li>
</ul>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * 中文请求参数转换,请求实体字段配合 {@link ZhBindAlias} 使用
 * 实现原理：自定义实现 mvc 参数转换器 {@link org.springframework.web.method.support.HandlerMethodArgumentResolver}
 */</span>
<span class="nd">@Documented</span>
<span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">PARAMETER</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">ZhBindConvertor</span> <span class="o">{</span>

    <span class="kt">boolean</span> <span class="nf">required</span><span class="o">()</span> <span class="k">default</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">FIELD</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">ZhBindAlias</span> <span class="o">{</span>
    <span class="cm">/** 字段的中文别名 */</span>
    <span class="nc">String</span> <span class="nf">value</span><span class="o">();</span>

    <span class="cm">/** 同名的情况下绑定到第几个参数 */</span>
    <span class="kt">int</span> <span class="nf">index</span><span class="o">()</span> <span class="k">default</span> <span class="mi">0</span><span class="o">;</span>

    <span class="cm">/** 是否默认添加到 query 条件构建中 */</span>
    <span class="kt">boolean</span> <span class="nf">includeQuery</span><span class="o">()</span> <span class="k">default</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>抽取公用查询参数类</li>
</ul>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * 公共查询参数
 */</span>
<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ZhSearchReq</span> <span class="o">{</span>

    <span class="nd">@ZhBindAlias</span><span class="o">(</span><span class="s">"录入时间"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">startTime</span><span class="o">;</span>

    <span class="nd">@ZhBindAlias</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"录入时间"</span><span class="o">,</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">endTime</span><span class="o">;</span>

    <span class="cm">/** 自定义查询字段(对应变化的部分) */</span>
    <span class="nd">@ZhBindAlias</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"extra"</span><span class="o">,</span> <span class="n">includeQuery</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">extras</span><span class="o">;</span>

    <span class="cm">/**
     * 排序字段, json 字符串，示例：
     * {“录入时间”: "ascend", "分配时间": "descend"}
     * 按录入时间升序，分配时间降序排列，默认升序
     */</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">sorter</span><span class="o">;</span>

    <span class="nd">@Min</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    <span class="nd">@ZhBindAlias</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"current"</span><span class="o">,</span> <span class="n">includeQuery</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">current</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="nd">@Min</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    <span class="nd">@ZhBindAlias</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"pageSize"</span><span class="o">,</span> <span class="n">includeQuery</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">pageSize</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>

    <span class="cm">/** 默认按录入时间降序排列 */</span>
    <span class="kd">private</span> <span class="nc">Sort</span> <span class="nf">defaultSort</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">by</span><span class="o">(</span><span class="s">"录入时间"</span><span class="o">).</span><span class="na">descending</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 获取子类字段的值,子类需要有 getter 方法
     * @deprecated
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">filedCriteriaForSubClass</span><span class="o">(</span><span class="nc">Criteria</span> <span class="n">criteria</span><span class="o">,</span> <span class="nc">Field</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Method</span><span class="o">[]</span> <span class="n">methods</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethods</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">methods</span><span class="o">)</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="n">m</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"get"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">m</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">findAny</span><span class="o">()</span>
                <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="nc">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
                        <span class="c1">// filedCriteria(criteria, f, value);</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InvocationTargetException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Sort</span> <span class="nf">sort</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">sorter</span> <span class="o">=</span> <span class="n">getSorter</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">sorter</span><span class="o">))</span> <span class="k">return</span> <span class="n">defaultSort</span><span class="o">();</span>
        <span class="nc">HashMap</span> <span class="n">sorterMap</span> <span class="o">=</span> <span class="nc">JSONObject</span><span class="o">.</span><span class="na">parseObject</span><span class="o">(</span><span class="n">sorter</span><span class="o">,</span> <span class="nc">HashMap</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">sorterMap</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="k">return</span> <span class="n">defaultSort</span><span class="o">();</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Sort</span><span class="o">.</span><span class="na">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">sorterMap</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">sorterMap</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="nc">Sort</span><span class="o">.</span><span class="na">Order</span> <span class="n">order</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"descend"</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">order</span> <span class="o">=</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">Order</span><span class="o">.</span><span class="na">desc</span><span class="o">(</span><span class="n">k</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">order</span> <span class="o">=</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">Order</span><span class="o">.</span><span class="na">asc</span><span class="o">(</span><span class="n">k</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="n">orders</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="o">});</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">orders</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="k">return</span> <span class="n">defaultSort</span><span class="o">();</span>
        <span class="k">return</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">by</span><span class="o">(</span><span class="n">orders</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 由于数据库选型原因，与 MongoDB 查询条件强绑定
     */</span>
    <span class="kd">public</span> <span class="nc">Criteria</span> <span class="nf">getQueryCriteria</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Criteria</span> <span class="n">criteria</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Criteria</span><span class="o">();</span>
        <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">ZhSearchReq</span><span class="o">&gt;</span> <span class="n">reqClass</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">superclass</span> <span class="o">=</span> <span class="n">reqClass</span><span class="o">.</span><span class="na">getSuperclass</span><span class="o">();</span>
        <span class="nc">Field</span><span class="o">[]</span> <span class="n">superFields</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Field</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">superclass</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">Object</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">superFields</span> <span class="o">=</span> <span class="n">superclass</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">Field</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">reqClass</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">();</span>
        <span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">fields</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">f</span> <span class="o">-&gt;</span> <span class="n">filedCriteria</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span> <span class="n">f</span><span class="o">));</span>
        <span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">superFields</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">f</span> <span class="o">-&gt;</span> <span class="n">filedCriteria</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span> <span class="n">f</span><span class="o">));</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">getStartTime</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">getEndTime</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">criteria</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="s">"录入时间"</span><span class="o">).</span><span class="na">gte</span><span class="o">(</span><span class="n">getStartTime</span><span class="o">()).</span><span class="na">lte</span><span class="o">(</span><span class="n">getEndTime</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="c1">// 对于动态参数的处理</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">MapUtil</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">extras</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">extras</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="nc">CollUtil</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">v</span><span class="o">))</span> <span class="o">{</span>
                    <span class="c1">// warning 与具体业务逻辑相关,可以前端确定公用的处理模型</span>
                    <span class="k">if</span> <span class="o">(!</span><span class="n">v</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"全选"</span><span class="o">))</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                            <span class="c1">// 根据业务逻辑确定单值的查询定义</span>
                            <span class="n">criteria</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">k</span><span class="o">).</span><span class="na">is</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                            <span class="c1">// 根据业务逻辑确定多值的查询定义</span>
                            <span class="n">criteria</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">k</span><span class="o">).</span><span class="na">in</span><span class="o">(</span><span class="n">v</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">});</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">criteria</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 对于单个查询参数的处理
     */</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">filedCriteria</span><span class="o">(</span><span class="nc">Criteria</span> <span class="n">criteria</span><span class="o">,</span> <span class="nc">Field</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">fName</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="s">"sorter"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">fName</span><span class="o">))</span> <span class="k">return</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">typeName</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getGenericType</span><span class="o">().</span><span class="na">getTypeName</span><span class="o">();</span>
        <span class="nc">ZhBindAlias</span> <span class="n">alias</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">ZhBindAlias</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 内部调用，不会有问题</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="k">return</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">nonNull</span><span class="o">(</span><span class="n">alias</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">alias</span><span class="o">.</span><span class="na">includeQuery</span><span class="o">())</span> <span class="k">return</span><span class="o">;</span>
            <span class="nc">String</span> <span class="n">where</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="na">value</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">"java.lang.String"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">typeName</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">where</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"时间"</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// 单值采用前缀匹配查询</span>
                <span class="n">criteria</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">where</span><span class="o">).</span><span class="na">regex</span><span class="o">(</span><span class="s">"^"</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="s">"java.util.List&lt;java.lang.String&gt;"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">typeName</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">where</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"时间"</span><span class="o">))</span> <span class="o">{</span>
                <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;)</span> <span class="n">value</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">values</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"全选"</span><span class="o">))</span> <span class="o">{</span>
                    <span class="c1">// 多值采用 $in 查询</span>
                    <span class="n">criteria</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">where</span><span class="o">).</span><span class="na">in</span><span class="o">(</span><span class="n">values</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// 等值查询</span>
            <span class="n">criteria</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">fName</span><span class="o">).</span><span class="na">is</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>扩展查询参数类</li>
</ul>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomerSearchReq</span> <span class="kd">extends</span> <span class="nc">ZhSearchReq</span> <span class="o">{</span>

    <span class="nd">@ZhBindAlias</span><span class="o">(</span><span class="s">"跟进状态"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">followState</span><span class="o">;</span>

    <span class="nd">@ZhBindAlias</span><span class="o">(</span><span class="s">"手机号"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">mobile</span><span class="o">;</span>

    <span class="nd">@ZhBindAlias</span><span class="o">(</span><span class="s">"姓名"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>使用</li>
</ul>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nd">@GetMapping</span><span class="o">()</span>
<span class="nd">@Operation</span><span class="o">(</span><span class="n">summary</span> <span class="o">=</span> <span class="s">"线索列表"</span><span class="o">)</span>
<span class="kd">public</span> <span class="no">R</span><span class="o">&lt;</span><span class="nc">PageResult</span><span class="o">&lt;</span><span class="nc">LinkedHashMap</span><span class="o">&gt;&gt;</span> <span class="nf">searchPage</span><span class="o">(</span><span class="nd">@ZhBindConvertor</span> <span class="nc">CustomerSearchReq</span> <span class="n">searchReq</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="no">R</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">customerSearchService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">searchReq</span><span class="o">));</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>重构质量保证-测试用例
    <ul>
      <li>只写了集成测试用例，保证基本的全流程准确性</li>
    </ul>
  </li>
</ul>

<h2 id="总结"><span class="me-2">总结</span><a href="#总结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="涉及知识点"><span class="me-2">涉及知识点</span><a href="#涉及知识点" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>Spring
    <ul>
      <li>SpringMVC 参数绑定流程及自定义参数解析器实现
        <ul>
          <li>GET 类型请求参数解析</li>
          <li>POST 类型请求参数解析</li>
        </ul>
      </li>
      <li>自定义参数解析器如何配置生效</li>
    </ul>
  </li>
  <li>反射:
    <ul>
      <li>根据类型实例化对象</li>
      <li>字段信息获取与对象字段设置</li>
      <li>字段类型信息获取和区分各种不同类型</li>
      <li>父类字段信息获取以及子类字段信息如何获取</li>
      <li>对象示例方法信息获取和方法执行</li>
    </ul>
  </li>
  <li>自定义注解的使用</li>
  <li>测试用例
    <ul>
      <li>使用了 testcontainers + docker mongodb + mockmvc 编写集成测试用例</li>
      <li>json 文件 + MongoTemplate#insert 完成测试前数据准备</li>
      <li>MongoTemplate#dropCollection 完成测试后数据清理</li>
      <li>MockMvc 对于响应数据的各种准确性断言</li>
    </ul>
  </li>
</ul>

<h3 id="遇到的问题"><span class="me-2">遇到的问题</span><a href="#遇到的问题" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>父类方法反射获取子类字段的取值(子类实例调用时)
    <ul>
      <li>解决：忘记了 <strong>f.setAccessible(true)</strong>;</li>
      <li>没有 f.setAccessible(true) 的时候也可以使用调用反射方法 getter + field name 的方式获取值，但很不 clean 也会有更大性能开销？<a href="https://github.com/saveole/custom_mvc_method_argument_resolver/blob/main/src/test/java/com/example/benchmark/ReflectFieldGetVSGetterMethodInvoke.java">benchmark</a></li>
    </ul>
  </li>
  <li>spring doc openapi 参数转换器问题
    <ul>
      <li>通过 WebMvcConfigurer#addArgumentResolvers 解决</li>
    </ul>
  </li>
</ul>

<h3 id="存在的问题及可以继续改进的地方"><span class="me-2">存在的问题及可以继续改进的地方</span><a href="#存在的问题及可以继续改进的地方" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>公用查询参数类只支持一层继承体系类的处理，可以根据业务实际需要做支持处理或做规范</li>
  <li>公用查询参数类获取 query 条件的方法与数据库类型以及业务强绑定，可以在这一层根据实际需求再做一层抽象</li>
  <li>由于业务逻辑简单，没有做单元测试，只做了集成测试</li>
  <li>反射获取字段信息时没有做缓存，可以 <a href="https://github.com/saveole/custom_mvc_method_argument_resolver/blob/main/src/test/java/com/example/benchmark/ReflectGetFieldsUsingCacheOrNot.java">benchmark</a> 下看看对于应用的性能提升</li>
</ul>

<h2 id="参考及示例代码"><span class="me-2">参考及示例代码</span><a href="#参考及示例代码" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>代码：</p>

<p><a href="https://github.com/saveole/custom_mvc_method_argument_resolver">custom_mvc_method_argument_resolver</a></p>

<p>参考：</p>

<p><a href="https://www.petrikainulainen.net/programming/spring-framework/spring-from-the-trenches-creating-a-custom-handlermethodargumentresolver/">Spring From the Trenches: Creating a Custom HandlerMethodArgumentResolver</a></p>

<p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-methods">mvc-ann-methods</a></p>

<p><a href="https://docs.oracle.com/javase/tutorial/reflect/member/fieldTypes.html">oracle-reflect-fieldTypes</a></p>

<!-- ##{"timestamp":1683634903}## -->

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>,
          <a href="/categories/java/">Java</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/spring/"
            class="post-tag no-text-decoration"
          >Spring</a>
        
          <a
            href="/tags/java/"
            class="post-tag no-text-decoration"
          >Java</a>
        
          <a
            href="/tags/spring-web-mvc/"
            class="post-tag no-text-decoration"
          >Spring Web MVC</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Spring%20Boot%20MVC%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8%20-%20saveole&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fspring-mvc-customized-method-argument-resolver%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Spring%20Boot%20MVC%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8%20-%20saveole&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fspring-mvc-customized-method-argument-resolver%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fspring-mvc-customized-method-argument-resolver%2F&text=Spring%20Boot%20MVC%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8%20-%20saveole" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/spring-mvc-customized-method-argument-resolver/">Spring Boot MVC 自定义参数解析器</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/java-app-docker-image/">Java 应用如何构建 Docker 镜像</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/saveole-tech-weekly-0/">Saveole's Weekly Tech Review, Issue 0</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/jekyll-chirpy/">博客方案：Jekyll + Chirpy</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/use-slidev-make-ppt-and-deploy-to-giithub-pages/">用 Slidev 写 PPT 并使用 Github Pages 部署到自己的博客上</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/java/">Java</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/graalvm/">GraalVM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ppt/">PPT</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/apm/">APM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blog/">Blog</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/go-raft/">Go， Raft</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">Jekyll</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/jshell/">JShell</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/jvm/">JVM</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="d-none ps-0 pe-4">
    <h2 class="panel-heading ps-3 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/graalvm-native-java-base64-command-line-tool/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1714369080"
  data-df="ll"
  
>
  Apr 29, 2024
</time>

              <h4 class="pt-0 my-2">GraalVM Native + Base64 编解码命令行小工具开发</h4>
              <div class="text-muted">
                <p>初衷：
    
      浏览  V 站 帖子有很多 Base64 加密的信息，希望能够快速解密。
    
  
  实现：
    
      
        v1：直接使用 JShell 命令行运行 Java 代码解密

        1
2
3
4
5
6
7
8
9
10
11
12
  ant@ant:~$ jshell 
  |  Welcome to JShell ...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/spring-native-first-cup/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1712467830"
  data-df="ll"
  
>
  Apr  7, 2024
</time>

              <h4 class="pt-0 my-2">Spring Native 初体验</h4>
              <div class="text-muted">
                <p>项目背景
    
      mqtt 的消费端应用，应用逻辑较简单，主要是消费 mqtt 消息，然后做对应的持久化(写多读少)操作
      项目架构主要使用到了 Spring Boot 作为 IoC 容器，MongoDB 作为存储，然后开源的 mqtt-spring-boot-starter 作为 mqtt 客户端
      当前存在的问题：
        
          ...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/saveole-tech-weekly-0/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1726908630"
  data-df="ll"
  
>
  Sep 21, 2024
</time>

              <h4 class="pt-0 my-2">Saveole's Weekly Tech Review, Issue 0</h4>
              <div class="text-muted">
                <p>JDK23|SpringBoot CDS|ZGC|Go SSE|Raft</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Older">
      <p>-</p>
    </div>
  

  
    <a
      href="/posts/win10-docker-desktop-install-and-setting/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>Win10 Docker 环境安装及设置</p>
    </a>
  
</nav>

            
              
              <!-- The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'saveole/saveole.github.io',
      'data-repo-id': 'R_kgDOKgQ2Qw',
      'data-category': 'General',
      'data-category-id': 'DIC_kwDOKgQ2Q84Cfx18',
      'data-mapping': 'pathname',
      'data-strict' : '0',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': 'en',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://twitter.com/saveole">saveole</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.0.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/java/">Java</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/graalvm/">GraalVM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ppt/">PPT</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/apm/">APM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blog/">Blog</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/go-raft/">Go， Raft</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">Jekyll</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/jshell/">JShell</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/jvm/">JVM</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->
    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->




  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.11/dayjs.min.js,npm/dayjs@1.11.11/locale/en.min.js,npm/dayjs@1.11.11/plugin/relativeTime.min.js,npm/dayjs@1.11.11/plugin/localizedFormat.min.js,npm/tocbot@4.27.20/dist/tocbot.min.js"></script>






<script src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  







    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5">Oops! No results found.</p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

