[
  
  {
    "title": "Saveole's Tech Review, Issue 1",
    "url": "/posts/saveole-tech-review-1/",
    "categories": "Randomly",
    "tags": "Java, ZGC, Virtual Thread, eBPF",
    "date": "2025-03-21 21:50:30 +0800",
    





    
    "snippet": "Post      Java                  JDK 24 å‘å¸ƒäº†ï¼                  JDK 24 æœ€è¿‘(2025-03-18)å‘å¸ƒäº†, è®²ä¸‹å‡ ä¸ªè®©æˆ‘æ„Ÿå…´è¶£çš„åœ°æ–¹å§ã€‚                      Compact Object Headers                              å‹ç¼©å¯¹è±¡å¤´ï¼šå°† 64 ä½æœºå™¨çš„ HotSpo...",
    "content": "Post      Java                  JDK 24 å‘å¸ƒäº†ï¼                  JDK 24 æœ€è¿‘(2025-03-18)å‘å¸ƒäº†, è®²ä¸‹å‡ ä¸ªè®©æˆ‘æ„Ÿå…´è¶£çš„åœ°æ–¹å§ã€‚                      Compact Object Headers                              å‹ç¼©å¯¹è±¡å¤´ï¼šå°† 64 ä½æœºå™¨çš„ HotSpot JVM å¯¹è±¡å¤´ä» 96 - 128 ä½å‹ç¼©ä¸º 64 ä½ï¼Œä¸”ä¿è¯ç”±æ­¤é€ æˆçš„åå/å»¶è¿ŸæŸå¤±ä¸è¶…è¿‡ 5%ï¼Œç›¸å…³çš„é¡¹ç›®æ˜¯ Liliputã€‚Java ä¸€ç›´ä»¥è¾ƒå¤§çš„å†…å­˜å¼€é”€é—»åï¼Œå¾ˆå¤§ä¸€å—åŸå› å°±æ˜¯ Java å¯¹è±¡çš„å†—ä½™è®¾è®¡ï¼Œåœ¨äº‘åŸç”Ÿæ—¶ä»£è¿™çš„ç¡®æ˜¯ä¸€ä¸ªåŠ£åŠ¿ã€‚å¥½åœ¨ç¤¾åŒºåœ¨è¿™å—ç»ˆäºæœ‰æ‰€åŠ¨ä½œï¼Œæœ€è¿‘ä¼šèŠ±æ—¶é—´çœ‹çœ‹å‹ç¼©å¯¹è±¡å¤´åœ¨å†…å­˜è¿™å—æœ‰å¤šå¤§æå‡ã€‚                                      Stream Gatherers                              è¿™ä¸ª JEP æ˜¯å¯¹ Stream API çš„å¢å¼ºï¼Œç”¨æˆ·èƒ½å¤Ÿè‡ªå®šä¹‰æ„å»ºæµçš„ä¸­é—´(å¦‚ jdk æä¾›çš„ filter/map/flatMap/distinct/limit ç­‰è¿”å› Stream&lt;T&gt; çš„æ–¹æ³•)æ“ä½œï¼Œç®€å•ç”¨æ³•ï¼šsource.gather(...).gather(...).gather(...).collect(...)ã€‚                                      Ahead-of-Time Class Loading &amp; Linking                              åŠ é€Ÿ JVM åº”ç”¨å¯åŠ¨æ—¶é—´çš„æŠ€æœ¯ï¼Œé€šè¿‡ç›‘æ§å’Œå­˜å‚¨ç³»ç»Ÿåœ¨è¿è¡Œæ—¶çš„ class ç­‰ä¿¡æ¯ï¼Œåœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶ç›´æ¥é“¾æ¥/åŠ è½½ä¸Šæ¬¡å­˜å‚¨çš„æ–‡ä»¶åˆ°å†…å­˜ç›´æ¥è¿è¡Œï¼Œå¤§å¤§å‡å°‘åº”ç”¨çš„å¯åŠ¨æ—¶é—´ã€‚                                      Prepare to Restrict the Use of JNI                              å¼€å§‹é™åˆ¶ JNI çš„ä½¿ç”¨ï¼Œå¼•å¯¼å¼€å‘è€…ä½¿ç”¨ Foreign Function &amp; Memory APIã€‚                                      Class-File API                              ç›´æ¥æ“ä½œå­—èŠ‚ç æ–‡ä»¶çš„ APIï¼Œå› ä¸º Java å…­ä¸ªæœˆçš„å‘ç‰ˆèŠ‚å¥å¯¼è‡´å­—èŠ‚ç æ–‡ä»¶æ ¼å¼å˜åŒ–åŠ å¿«ï¼Œæ€•ç¬¬ä¸‰æ–¹å­—èŠ‚ç æ“ä½œåº“å¦‚ ASM ç­‰è·Ÿä¸ä¸ŠèŠ‚å¥ï¼Œå®˜æ–¹è‡ªå·±ä¸‹åœºå¹²æ´»äº†ï¼Œè¿™å¯¹äº APM ç±»è½¯ä»¶ç ”å‘å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚                                      Module Import Declarations (Second Preview)                              ç±»ä¼¼å°† import java.util.*  çš„å¼•ç”¨å˜æ›´ä¸º import module java.baseï¼Œå¦‚æœå¼•ç”¨æŸä¸€ä¸ªæ¨¡å—çš„ç±»æ¯”è¾ƒå¤šçš„è¯ï¼Œè¿˜æ˜¯èƒ½å¤§å¤§ç®€åŒ– import è¯­å¥çš„ã€‚                                      ZGC: Remove the Non-Generational Mode                              ä¸Šä¸ªç‰ˆæœ¬ ZGC é»˜è®¤ä½¿ç”¨åˆ†ä»£æ¨¡å¼ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­æ˜¯ç§»é™¤ ZGC çš„éåˆ†ä»£æ¨¡å‹ã€‚                                      Permanently Disable the Security Manager                              JDK 17 ä¸­å¼€å§‹å‡†å¤‡ç§»é™¤ Security Managerï¼Œç°åœ¨æ­£å¼æ°¸ä¹…ç§»é™¤ã€‚                                      Synchronize Virtual Threads without Pinning                              ä¹‹å‰ç‰ˆæœ¬çš„ Virtual Thread + synchronized åœ¨æ‰§è¡Œæ–¹æ³•å‡ºç°é˜»å¡(ä¾‹å¦‚ IO åœºæ™¯)(pinning)çš„æƒ…å†µä¸‹ï¼ŒVT ä¸èƒ½ unmount å…¶ä¾èµ–çš„åº•å±‚ OS çº¿ç¨‹ï¼Œå¯èƒ½å¯¼è‡´çº¿ç¨‹é¥¥é¥¿ç”šè‡³æ­»é”ç­‰é—®é¢˜(å¯ä»¥é€šè¿‡ jdk.VirtualThreadPinned JFR äº‹ä»¶ç›‘æ§)ï¼ŒNetflix å›¢é˜Ÿä¹‹å‰ä¹Ÿé‡åˆ°è¿‡ï¼ŒJEP491 è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç”±æ­¤å¯¼è‡´çš„æ­»é”ä»£ç æ¡ˆä¾‹ï¼š                                                    ```javaimport java.time.Duration;import java.util.List;import java.util.concurrent.locks.ReentrantLock;import java.util.stream.IntStream;import java.util.stream.Stream;/** * Demonstrate potential for deadlock on a {@link ReentrantLock} when there is both a synchronized and * non-synchronized path to that lock, which can allow a virtual thread to hold the lock, but * other pinned waiters to consume all the available workers. */public class VirtualThreadReentrantLockDeadlock {    public static void main(String[] args) {        final boolean shouldPin = args.length == 0 ||Boolean.parseBoolean(args[0]);        final ReentrantLock lock = new ReentrantLock(true); // With faireness to ensure that the unpinned thread is next in line        lock.lock();            Runnable takeLock = () -&gt; {            try {                System.out.println(Thread.currentThread() + \" waiting for lock\");                lock.lock();                System.out.println(Thread.currentThread() + \" took lock\");            } finally {                lock.unlock();                System.out.println(Thread.currentThread() + \" released lock\");            }        };        Thread unpinnedThread = Thread.ofVirtual().name(\"unpinned\").start(takeLock);        List&lt;Thread&gt; pinnedThreads = IntStream.range(0, Runtime.getRuntime().availableProcessors())    .mapToObj(i -&gt; Thread.ofVirtual().name(\"pinning-\" + i).start(() -&gt; {                if (shouldPin) {                    synchronized (new Object()) {                        takeLock.run();                    }                } else {                    takeLock.run();                }            })).toList();            lock.unlock();            Stream.concat(Stream.of(unpinnedThread), pinnedThreads.stream()).forEach(thread -&gt; {            try {                if (!thread.join(Duration.ofSeconds(3))) {                    throw new RuntimeException(\"Deadlock detected\");                                    }            } catch (InterruptedException e) {                throw new RuntimeException(e);            }        });    }}```    ```(base) saveole@saveoledeMacBook-Pro src % java VirtualThreadReentrantLockDeadlock.javaVirtualThread[#25,unpinned]/runnable@ForkJoinPool-1-worker-1 waiting for lockVirtualThread[#28,pinning-0]/runnable@ForkJoinPool-1-worker-1 waiting for lockVirtualThread[#30,pinning-2]/runnable@ForkJoinPool-1-worker-3 waiting for lockVirtualThread[#29,pinning-1]/runnable@ForkJoinPool-1-worker-2 waiting for lockVirtualThread[#33,pinning-5]/runnable@ForkJoinPool-1-worker-6 waiting for lockVirtualThread[#31,pinning-3]/runnable@ForkJoinPool-1-worker-4 waiting for lockVirtualThread[#35,pinning-7]/runnable@ForkJoinPool-1-worker-9 waiting for lockVirtualThread[#32,pinning-4]/runnable@ForkJoinPool-1-worker-5 waiting for lockVirtualThread[#34,pinning-6]/runnable@ForkJoinPool-1-worker-7 waiting for lockVirtualThread[#36,pinning-8]/runnable@ForkJoinPool-1-worker-8 waiting for lockVirtualThread[#38,pinning-9]/runnable@ForkJoinPool-1-worker-10 waiting for lockException in thread \"main\" java.lang.RuntimeException: Deadlock detectedat VirtualThreadReentrantLockDeadlock.lambda$main$3(VirtualThreadReentrantLockDeadlock.java:49)at java.base/java.util.stream.Streams$StreamBuilderImpl.forEachRemaining(Streams.java:411)at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734)at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:762)at VirtualThreadReentrantLockDeadlock.main(VirtualThreadReentrantLockDeadlock.java:46)```                            Reproducing a Java 21 virtual threads deadlock scenario with TLA+                  â€‹å¯¹ Java 21 è™šæ‹Ÿçº¿ç¨‹ + synchronized é€ æˆæ­»é”çš„è§£é‡Šæ–‡ç« ï¼Œå€¼å¾—ä¸€çœ‹ã€‚                          Spring Framework 7.0 - preview ç‰ˆæœ¬          Programmatic Bean Registration                  ç¼–ç¨‹åŒ–æ§åˆ¶ Spring Bean çš„æ³¨å†Œé€»è¾‘ï¼Œå¯ä»¥å’Œ Spring AOT ä»¥åŠ GraalVM native images å…¼å®¹ä½¿ç”¨ã€‚                    Null-safety                  ä½¿ç”¨ Jspecify è¿›è¡Œ Null å€¼æ³¨è§£æ–¹å¼æ£€æŸ¥ã€‚                    API versioning support in web applications                  é€šè¿‡åœ¨ @RequestMapping ä¸­æŒ‡å®š API ç‰ˆæœ¬è·¯ç”±åˆ°ä¸åŒçš„ controller æ–¹æ³•ä¸­ã€‚                    Optional support with null-safe and Elvis operators in SpEL expressions                  ç»ˆäºï¼ï¼ï¼ SpEL + Optional : Optional&lt;User&gt; -&gt; user?.nameSpEL + ä¸‰ç›®è¡¨è¾¾å¼ : (name != null ? name : \"Unknown\") -&gt; \"name ?: 'Unknown'\"                    GitHub  eclipse-jifa/jifa - åœ¨çº¿ GC æ—¥å¿—/Heap Dump/JFR æ–‡ä»¶å¯è§†åŒ–åˆ†æå·¥å…·ã€‚  java24-demo - JDK24 ç‰¹æ€§ç›¸å…³çš„ä»£ç ç¤ºä¾‹å’Œè§£é‡Šã€‚  hello-ebpf - ç”¨ Java ä»£ç å†™ eBPF ç¨‹åºã€‚Video  Project Lilliput - Beyond Compact Headers  Build a lightning fast Firewall with Java &amp; eBPF - Johannes Bechberger - CPH DevFest 2024Book  NaN"
  },
  
  {
    "title": "Unit Test with Mockito",
    "url": "/posts/unit-test-with-Mockito/",
    "categories": "Test",
    "tags": "Java, Mockito, Unit Test, Spring",
    "date": "2025-03-01 17:10:31 +0800",
    





    
    "snippet": "Unit Test with MockitoTags: ItTest, Mock, MockStatic, Spring Event, UT, æœªå‘å¸ƒå¤‡æ³¨: should be a blog in my Github blog project in some time      when â€¦ thenReturn â€¦ å½“æ‰§è¡ŒæŸäº›æ–¹æ³•æ—¶è¿”å› mock æ•°æ®ã€‚      // userServi...",
    "content": "Unit Test with MockitoTags: ItTest, Mock, MockStatic, Spring Event, UT, æœªå‘å¸ƒå¤‡æ³¨: should be a blog in my Github blog project in some time      when â€¦ thenReturn â€¦ å½“æ‰§è¡ŒæŸäº›æ–¹æ³•æ—¶è¿”å› mock æ•°æ®ã€‚      // userService should be annotated with @Mock  when(userService).thenReturn(some_mock_value);            when â€¦ thenReturn â€¦ å¯ä»¥é“¾å¼ thenReturn å¤šä¸ª mock å€¼ç”¨äºæŒ‡å®šæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ—¶è¿”å›ä¸åŒçš„å€¼ã€‚      @Test  @DisplayName(\"æ¯æ—¥åˆ†é…ä¸Šé™æµ‹è¯•-è½®æµåˆ†é…+ä¸­é—´å‘˜å·¥æ— åˆ†é…æƒé™\")  void test_daily_limit_with_middle_limit_0_should_ok() {      when(mongoTemplate.find(any(), eq(ClueAutomaticAllot.class))).thenReturn(mockAllots);      when(mongoTemplate.updateFirst(any(), any(), eq(defaultColl))).thenReturn(mockResult());      when(clueAutomaticAllotRepo.saveAll(mockAllots)).thenReturn(null);      when(userService.findAllByUserIdsIn(anyList()))              .thenReturn(mockUserAllOnDuty(allotUserIds))              .thenReturn(mockUserAllOnDuty(List.of(\"627a29d4b3e8940001ae07b0\")))              .thenReturn(mockUserAllOnDuty(List.of(\"627a29d4b3e8940001ae07b0\")));      when(mongoTemplate.aggregate(any(Aggregation.class), eq(defaultColl), eq(UserAllotData.class)))              .thenReturn(mockAggResultEmpty())              .thenReturn(mockAggResultWithLimit_1())              .thenReturn(mockAggResultWithLimit_2());          // ç¬¬ä¸€æ¬¡åˆ†é…ç»™ç”¨æˆ·1      clueAutomaticAllotService.autoAllot(mockInsertTask(List.of(matchPoolAndChannel_1())));      assertEquals(\"61c877b13222fa00011c91bb\", mockAllots.get(1).getLastAllotUser());      // ç¬¬äºŒæ¬¡åˆ†é…ç»™ç”¨æˆ·3      clueAutomaticAllotService.autoAllot(mockInsertTask(List.of(matchPoolAndChannel_1())));      assertEquals(\"627a29d4b3e8940001ae07b0\", mockAllots.get(1).getLastAllotUser());      // ç¬¬ä¸‰æ¬¡åˆ†é…ç»™ç”¨æˆ·3      clueAutomaticAllotService.autoAllot(mockInsertTask(List.of(matchPoolAndChannel_1())));      assertEquals(\"627a29d4b3e8940001ae07b0\", mockAllots.get(1).getLastAllotUser());          // ç›¸åº”çš„ event äº‹ä»¶ä»£ç é€»è¾‘åº”è¯¥æ‰§è¡Œäº†ä¸‰æ¬¡      verify(opLogService, times(3)).publishOplog(any(OpLog.class));      verify(eventPublisher, times(3)).publishEvent(any(ReclaimTaskEvent.class));  }            thenAnswer() æ ¹æ®æ–¹æ³•å‚æ•°åŠ¨æ€çµæ´»çš„è¿”å›æ•°æ®ã€‚      @ExtendWith(MockitoExtension.class)  class PersonServiceTest {          @Mock      PersonRepository repository;          @InjectMocks      PersonService service;          List&lt;Person&gt; people = List.of(              new Person(\"1\", \"jack\", 15),              new Person(\"2\", \"jacsk\", 16),              new Person(\"3\", \"jackie\", 17)      );          @Test      void saveAllPeople() {          when(repository.save(any(Person.class))) // mock save æ“ä½œ                  .thenAnswer(invocation -&gt; invocation.getArgument(0)); // è¿”å›ä¼ å…¥çš„å‚æ•°          var ids = service.savePeople(people);          assertThat(ids).hasSize(3); // éªŒè¯ä¿å­˜äº† 3 ä¸ªå¯¹è±¡      }  }            doNothing().when(mock).method(any(Argument.class))  é€‚ç”¨ void æ–¹æ³•      doNothing().when(eventPublisher).publishEvent(any(ReclaimTaskEvent.class));        mockStatic  é™æ€æ–¹æ³• mock          å‰æï¼šåœ¨ resources æ–‡ä»¶å¤¹ä¸‹åˆ›å»º mockito-extensions æ–‡ä»¶å¤¹ï¼Œåˆ›å»º   org.mockito.plugins.MockMaker æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼šmock-maker-inline              single static method          try (MockStatic&lt;StaticClass&gt; staticClass = Mockito.mockStatic(StaticClass.class)) {      staticClass.when(StaticClsss::staticMethod).thenReturn(some_mock_value);  }                    nested static methods                  nested try blocks with Mockito mockStatic statementï¼                  try (MockedStatic&lt;ServletUtil&gt; servletUtilMockedStatic = Mockito.mockStatic(ServletUtil.class)) {      try (MockedStatic&lt;ContextUtil&gt; contextUtilMockedStatic = Mockito.mockStatic(ContextUtil.class)) {          contextUtilMockedStatic.when(ContextUtil::getServletRequest).thenReturn(null);          contextUtilMockedStatic.when(ContextUtil::currentCusColl).thenReturn(cusColl);          servletUtilMockedStatic.when(() -&gt; ServletUtil.getClientIP(null)).thenReturn(\"0.0.0.0\");          ModifyResult result = customerService.pickUp(List.of(notDistributedOne));          assertEquals(1, result.getSuccessCount());          assertEquals(0, result.getFailedCount());          // æ›´æ–°åæ•°æ®æ ¡éªŒ          LinkedHashMap updated = findOne(notDistributedOne);          assertEquals(\"å·²åˆ†é…\", updated.get(\"åˆ†é…çŠ¶æ€\"));          assertEquals(user.getId(), updated.get(\"followUser\"));          assertEquals(user.getName(), updated.get(\"è·Ÿè¿›äºº\"));          assertEquals(user.getName(), updated.get(\"æœ€è¿‘æ“ä½œäºº\"));          assertEquals(1, updated.get(\"é¢†å–æ¬¡æ•°\"));      }  }                          éªŒè¯æ–¹æ³•æ‰§è¡Œæ¬¡æ•° verify + times      // æ ¡éªŒå‘å¸ƒäº‹ä»¶æ¬¡æ•°  verify(eventPublisher, times(1)).publishEvent(any(ReclaimTaskEvent.class));  verify(eventPublisher, times(1)).publishEvent(any(OpLog.class));            éªŒè¯æ–¹æ³•æ‰§è¡Œé¡ºåº inOrder      // verify the methods are called once, in the right order  InOrder inOrder = inOrder(repository, translationService);  inOrder.verify(repository).findById(anyInt());  inOrder.verify(translationService).translate(anyString(), eq(\"en\"), eq(\"en\"));            spy() ç”¨äºéƒ¨åˆ† mock          You can intercept method calls to the dependencies for later verification.      You can mock some methods in the dependencies rather than all of them. This is called a partial mock.          @Test  void spyOnRepository() {      // Spy on the in-memory repository  \t\tPersonRepository personRepo = spy(new InMemoryPersonRepository());   \t\tPersonService personService = new PersonService(personRepo);  \t\tpersonService.savePeople(people.toArray(Person[]::new)); assertThat(personRepo.findAll()).isEqualTo(people);      // Verify the method calls on the spy      verify(personRepo, times(people.size())).save(any(Person.class));  }        æ–¹æ³•å…¥å‚æ ¡éªŒ ArgumentMatcher          åŸºæœ¬ç±»å‹ç³»åˆ—ï¼šanyByte, anyShort, anyInt, anyLong, anyFloat, anyDouble, anyChar, and anyBoolean.      é›†åˆç±»å‹ç³»åˆ—ï¼šanyCollection, anyList, anySet, and anyMap      å­—ç¬¦ä¸²ç³»åˆ—ï¼šanyString, startsWith, endsWith, and the two overloads of matches, one that takes a regular expression as a string and the other a Pattern.      null æ£€æŸ¥ï¼šisNull and isNotNull (and its companion, notNull, which is just an alias), and nullable(Class), which matches either null or a given type.      ç­‰å€¼åˆ¤æ–­ï¼šeq()        è‡ªå®šä¹‰æ–¹æ³•å…¥å‚æ ¡éªŒå™¨          å®ç° ArgumentMatcher&lt;T&gt;      argThat() + lambda Predicate        âš ï¸Â å¦‚æœæ˜¯åŸºæœ¬ç±»å‹å‚æ•°éœ€è¦å¯¹åº”ä½¿ç”¨ byteThat, shortThat, charThat, intThat, longThat, floatThat, doubleThat, and booleanThat. æ­¤ä¸¾å¯é¿å…å› ä¸ºè£…æ‹†ç®±é—®é¢˜å¼•èµ·çš„ NPE é—®é¢˜ã€‚      when(userRepo.findById(argThat(id -&gt; id.startsWith(\"user\")))).thenReturn(Optional.of(user));        Spring Boot Application Event Test  @DataMongoTest with testcontainers      BDDMockito given/when/then å†™æ³•ï¼š      @Test  public void findMaxId_BDD() {      given(repository.findAll()).willReturn(people);      assertThat(service.getHighestId()).isEqualTo(14);      then(repository).should().findAll();  }        Mock send spring event and consume spring event                  é’ˆå¯¹ ApplicationEvent äº‹ä»¶å¯ä»¥æ–­è¨€å•ä¸ªæ–¹æ³•å†…å‘é€äº†å‡ æ¬¡ event.          // æ ¡éªŒå‘å¸ƒäº‹ä»¶æ¬¡æ•°  verify(eventPublisher, times(1)).publishEvent(any(ReclaimTaskEvent.class));  verify(eventPublisher, times(1)).publishEvent(any(OpLog.class));                          How to assert a rest api with MockMvc      MvcResult result = mockMvc.perform(post(\"/api/users\").header(\"Authorization\", base64ForTestUser).contentType(MediaType.APPLICATION_JSON)              .content(\"{\\\"userName\\\":\\\"testUserDetails\\\",\\\"firstName\\\":\\\"xxx\\\",\\\"lastName\\\":\\\"xxx\\\",\\\"password\\\":\\\"xxx\\\"}\"))              .andDo(MockMvcResultHandlers.print())              .andExpect(status().isBadRequest())  \t\t\t\t\t\t.andExpect(jsonPath(\"data.total\").value(5))  \t\t\t\t\t\t// å¯¹äº json æ•°ç»„çš„ä¸­å…ƒç´ å­—æ®µè¿›è¡Œæ–­è¨€  \t\t\t\t\t\t.andExpect(jsonPath(\"data.content.[0].createUser\").value(\"62c7ec65baaca09ad14dbd9f\"))  \t\t\t\t\t\t// todo ä¹Ÿä¼šæœ‰ä¸­æ–‡ä¹±ç é—®é¢˜  \t\t\t\t\t\t.andExpect(content().string(Matchers.containsString(\"expected string\")))              .andReturn();      // æŒ‡å®šç¼–ç é˜²æ­¢ä¸­æ–‡ä¹±ç   String content = result.getResponse().getContentAsString(StandardCharsets.UTF_8);  // do what you want, usually do some assertions      Mock, Stub, Spy"
  },
  
  {
    "title": "Saveole's Tech Review, Issue 0",
    "url": "/posts/saveole-tech-review-0/",
    "categories": "Randomly",
    "tags": "Java, SSE, ZGC, Go, Raft",
    "date": "2024-09-21 16:50:30 +0800",
    





    
    "snippet": "Post      Java                  JDK 23 å‘å¸ƒäº†ï¼                  â€‹        å‰ä¸ä¹…ï¼Œgo å‘å¸ƒäº† 1.23 ç‰ˆæœ¬ï¼ŒJava æœ€è¿‘ä¹Ÿå¦‚æœŸå‘å¸ƒäº† JDK 23(none tls)ï¼Œä¸»è¦æ›´æ–°å¤§éƒ¨åˆ†è¿˜æ˜¯ preview é˜¶æ®µçš„ææ¡ˆï¼Œä¸ªäººå°è±¡æ·±åˆ»ç‚¹çš„ ä¸€(JEP474)æ˜¯ ZGC é»˜è®¤ä½¿ç”¨åˆ†ä»£æ¨¡å¼(Generational Mode), ...",
    "content": "Post      Java                  JDK 23 å‘å¸ƒäº†ï¼                  â€‹        å‰ä¸ä¹…ï¼Œgo å‘å¸ƒäº† 1.23 ç‰ˆæœ¬ï¼ŒJava æœ€è¿‘ä¹Ÿå¦‚æœŸå‘å¸ƒäº† JDK 23(none tls)ï¼Œä¸»è¦æ›´æ–°å¤§éƒ¨åˆ†è¿˜æ˜¯ preview é˜¶æ®µçš„ææ¡ˆï¼Œä¸ªäººå°è±¡æ·±åˆ»ç‚¹çš„ ä¸€(JEP474)æ˜¯ ZGC é»˜è®¤ä½¿ç”¨åˆ†ä»£æ¨¡å¼(Generational Mode), äºŒ(JEP471)æ˜¯ sun.misc.Unsafe çš„å¤§éƒ¨åˆ† memory-access ç›¸å…³çš„æ–¹æ³•è¢«æ ‡è®° @Deprecated äº†ï¼Œä»¥åä¼šç§»é™¤ï¼Œç±»åº“çš„å¼€å‘è€…éœ€è¦é¢å¤–æ³¨æ„ä¸‹ï¼Œå¯ä»¥ç”¨ JEP 193 å’Œ JEP 454 ä¸­æåŠçš„ API æ›¿ä»£ã€‚ps: ä» 471 çœ‹ï¼ŒJava çš„æ›´æ–°è¿˜æ˜¯å¾ˆå…‹åˆ¶çš„ï¼Œå……åˆ†è€ƒè™‘åˆ°è€ç”¨æˆ·çš„å…¼å®¹é—®é¢˜ï¼Œä½†å¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥çœ‹åˆ° Java çš„å¤§ä½“é‡å¯¹äºæ–°äº‹ç‰©çš„æ¨å¹¿è¿˜æ˜¯å¾ˆæ…¢çš„ï¼Œç°åœ¨ Java ä½¿ç”¨æœ€å¤šçš„ç‰ˆæœ¬è¿˜æ˜¯ Java 8ï¼Œæˆ‘åœ¨é¢è¯•å€™é€‰äººçš„æ—¶å€™ä¸€è¯´èµ· Java çš„æ–°ç‰¹æ€§æ˜¯ Lambda/Stream æµçš„æ—¶å€™å°±çš±èµ·äº†çœ‰å¤´ ğŸ˜‚          â€‹        ä¹Ÿå¯çœ‹çœ‹ foojay ä¸Šè¿™ç¯‡å¯¹äº JDK 23 çš„è§£è¯»æ–‡ç« ã€‚                            Spring Boot CDS support and Project Leyden anticipation                  â€‹        ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Spring Boot 3.3 + CDS + Leydon + Spring Native æ„å»ºåº”ç”¨ç¨‹åºä»¥æ˜¾è‘—å‡å°‘ Spring Boot åº”ç”¨çš„å¯åŠ¨æ—¶é—´å’Œè¿è¡Œæ—¶å†…å­˜æ¶ˆè€—ï¼Œéå¸¸æ¨èçœ‹ä¸€çœ‹è¯•ä¸€è¯•ã€‚                            Bending pause times to your will with Generational ZGC                  â€‹        Netflix ä½¿ç”¨ JDK21 + åˆ†ä»£ ZGC çš„å®è·µï¼Œéå¸¸å¥½ï¼Œä¿ºä¹Ÿæƒ³åœ¨ç”Ÿäº§ç¯å¢ƒè¯•è¯• ğŸ¶                          Go                  How to implement Server-Sent Events in Go                  â€‹        SSE(Server-Sent Events) æ˜¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯ä¸æ–­å‘é€ event çš„å•å‘é€šä¿¡åè®®(ä¸åŒäº WebSocket çš„åŒå‘é€šä¿¡ )ï¼Œåº•å±‚ä¹Ÿæ˜¯åŸºäº HTTPï¼Œå¯ä»¥ç”¨äºéœ€è¦æœåŠ¡ç«¯å®æ—¶ç”Ÿæˆå†…å®¹çš„åœºæ™¯ï¼Œå¦‚ ChatGPT çš„æµå¼ç›¸åº”ç­‰ã€‚          â€‹        è¿™ç¯‡æ–‡ç« ä½¿ç”¨ go çš„ net/http å®ç°äº†ä¸€ä¸ªç®€å•çš„ SSE æ¡ˆä¾‹ï¼Œå¯ä»¥çœ‹åˆ° go çš„åŸºç¡€ç±»åº“è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œæ¯” Java è¦ç®€æ´å¾ˆå¤šã€‚          å‰ä¸ä¹…ä½¿ç”¨ gin æ¡†æ¶ä¹Ÿå®ç°äº† SSEï¼š          func ScriptRecognize(c *gin.Context) {\tid := c.Param(\"id\")\tvar record models.ScriptUploadRecord\terr := models.FindOne(common.TB_SCRIPT, bson.M{\"_id\": bson.ObjectIdHex(id)}, nil, &amp;record)\tif err != nil {\t\tc.JSON(http.StatusOK, helpers.Fail(err))\t\treturn\t}\tif len(record.Texts) &gt; 0 {\t\ttxt := strings.Join(record.Texts, \"\")\t\tc.Stream(func(w io.Writer) bool {\t\t\tc.String(200, \"data: %s\\n\\n\", txt)\t\t\treturn false\t\t})\t\treturn\t}\tchanStream := make(chan string, 100)\tgo recognizer.RecognizeFromUrl(record.FileUrl, chanStream)\tcontent := make([]string, 0)\tc.Header(\"Content-Type\", \"text/event-stream\")\tc.Header(\"X-Accel-Buffering\", \"no\")\tc.Stream(func(w io.Writer) bool {\t\tif msg, ok := &lt;-chanStream; ok {\t\t\tfmt.Printf(\"è½¬æ–‡æœ¬ï¼š%s\", msg)\t\t\tc.String(200, \"data: %s\\n\\n\", msg)\t\t\tcontent = append(content, msg)\t\t\treturn true\t\t}\t\tgo updateScript(id, \"texts\", content)\t\treturn false\t})}                    â€‹        ä¸»è¦æ³¨æ„çš„å°±æ˜¯ï¼š1. header çš„æ§åˆ¶å‚æ•° 2. event å‘é€çš„æ ¼å¼                            Donâ€™t defer Close() on writable files                  â€‹        ä¸è¦å› ä¸ºä½¿ç”¨äº† defer io.Closer.Close() è€Œå¿½ç•¥äº†åç»­æ“ä½œç³»ç»Ÿå› ä¸º close syscall ä¸æˆåŠŸäº§ç”Ÿçš„ error ,å»ºè®®ç”¨ return f.Close() â€“&gt; os è¿˜æ˜¯ä¸ä¸€å®šé©¬ä¸Šåˆ·ç›˜ï¼Œæˆ–è€… return f.Sync() â€“&gt; é©¬ä¸Šåˆ·ç›˜ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚                            Implementing Raft: Part 2 - Commands and Log Replication                  â€‹        ä¸€ä¸ªå®ç°ç®€å• raft åè®®çš„å›½å¤–æ•™ç¨‹çš„ Log Replication éƒ¨åˆ†ï¼Œç¿”å®çš„ test case ä»¥åŠ log å¯è§†åŒ–(html è¡¨æ ¼å¯¹æ¯”å½¢å¼)åšçš„å¾ˆå¥½ï¼Œè¦æ˜¯åšæˆåŠ¨æ€å¯è§†åŒ–å°±æ›´å¥½äº†ã€‚                    GitHub  petclinic-efficient-container - ç»å…¸ Spring Boot æ¼”ç¤ºé¡¹ç›® spring-petclinic çš„ä¼˜åŒ–ç‰ˆ  eraft - ä¸€æ­¥æ­¥å®ç° raft åè®®å¹¶æ‰“é€ ä¸€ä¸ªåˆ†å¸ƒå¼ KV å­˜å‚¨  starflare - ç»™è‡ªå·± star çš„é¡¹ç›®åˆ†ç±»/æ‰“æ ‡ç­¾  omakub - é…ç½®å…¨æ–°å®‰è£…çš„ Ubuntu çš„å·¥å…·Video  Implementing Domain Driven Design with Spring by Maciej Walkowiak @ Spring I/O 2024Book      Build Your Own Database From Scratch in Go          çœ‹äº†ä¸€ç‚¹ï¼Œæ„Ÿè§‰å¾ˆä¸é”™ï¼Œæœ€è¿‘åœ¨å®ç° raft çš„æ—¶å€™å‘ç° go åŸºç¡€å¾ˆä¸å¥½ï¼Œå…ˆè¡¥åŸºç¡€ï¼Œåé¢å†æ¥å­¦ä¹ ã€‚      "
  },
  
  {
    "title": "ç”¨ Slidev å†™ PPT å¹¶ä½¿ç”¨ Github Pages éƒ¨ç½²åˆ°è‡ªå·±çš„åšå®¢ä¸Š",
    "url": "/posts/use-slidev-make-ppt-and-deploy-to-giithub-pages/",
    "categories": "åšå®¢",
    "tags": "Blog, PPT",
    "date": "2024-07-24 17:55:00 +0800",
    





    
    "snippet": "      Prerequisites          åŸºäº Github Pages æ„å»ºçš„é™æ€ä¸ªäººåšå®¢ç½‘ç«™            Steps                  ä½¿ç”¨ Slidev åˆ›å»ºè‡ªå·±çš„ ppt é¡¹ç›®å¹¶ä¸Šä¼ åˆ° Github ä¸Šçš„å•ç‹¬ Repository                    é…ç½®å¼€å¯ä»“åº“çš„ Github Pages                 ...",
    "content": "      Prerequisites          åŸºäº Github Pages æ„å»ºçš„é™æ€ä¸ªäººåšå®¢ç½‘ç«™            Steps                  ä½¿ç”¨ Slidev åˆ›å»ºè‡ªå·±çš„ ppt é¡¹ç›®å¹¶ä¸Šä¼ åˆ° Github ä¸Šçš„å•ç‹¬ Repository                    é…ç½®å¼€å¯ä»“åº“çš„ Github Pages                      é…ç½® Github Action                  æˆ‘çš„ .github/workflows/deploy.yml å¦‚ä¸‹ï¼š                  # Simple workflow for deploying static content to GitHub Pages  name: Deploy static content to Pages          on:    # Runs on pushes targeting the default branch    push:      branches: [\"main\"]            # Allows you to run this workflow manually from the Actions tab    workflow_dispatch:          # Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages  permissions:    contents: read    pages: write    id-token: write          # Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.  # However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.  concurrency:    group: \"pages\"    cancel-in-progress: false          jobs:    # Single deploy job since we're just deploying    deploy:      environment:        name: github-pages        url: $      runs-on: ubuntu-latest      steps:        - name: Checkout          uses: actions/checkout@v4        - name: Setup node          uses: actions/setup-node@v4          with:            node-version: \"lts/*\"        - name: Install dependencies          run: npm install        - name: Install slidev          run: npm i -g @slidev/cli        - name: Build          run: slidev build --base /java_app_build_docker_image/        - name: Setup Pages          uses: actions/configure-pages@v5        - name: Upload artifact          uses: actions/upload-pages-artifact@v3          with:            # Upload entire repository            path: dist        - name: Deploy to GitHub Pages          id: deployment          uses: actions/deploy-pages@v4                          Finish          å†™å¥½ ppt åï¼Œpush åˆ°ä»“åº“è‡ªåŠ¨æ„å»ºéƒ¨ç½²åˆ°è‡ªå·±çš„ä¸ªäººåšå®¢ä¸­ï¼Œæ•ˆæœï¼šJava åº”ç”¨å¦‚ä½•æ„å»º Docker é•œåƒ            Notes:          slidev build --base /java_app_build_docker_image/ éœ€è¦æŒ‡å®šç‰¹å®šå­è·¯ç”±çš„æ—¶å€™ï¼Œæœ€å¥½å°†å­è·¯ç”±åç§°å’Œä»“åº“åç§°ä¿æŒä¸€è‡´      æˆ‘æ„å»ºéƒ¨ç½²å¥½çš„ ppt åœ°å€åœ¨ Edge æµè§ˆå™¨ä¸‹æ²¡æœ‰é»˜è®¤é‡å®šå‘åˆ° /1 å³ ppt é¦–é¡µï¼Œä½† FireFox å°±å¯ä»¥ï¼Œå¾ˆå¥‡æ€ªï¼Œå¾…æˆ‘çœ‹çœ‹.      ä½¿ç”¨çš„ Slidev ä¸»é¢˜ï¼šacademic      å‚è€ƒçš„ PPTï¼š exploring-social-engineering-slides      "
  },
  
  {
    "title": "Java åº”ç”¨å¦‚ä½•æ„å»º Docker é•œåƒ",
    "url": "/posts/java-app-docker-image/",
    "categories": "åšå®¢",
    "tags": "Java, Docker, APM, PPT",
    "date": "2024-07-22 18:10:00 +0800",
    





    
    "snippet": "  slide",
    "content": "  slide"
  },
  
  {
    "title": "åšå®¢æ–¹æ¡ˆï¼šJekyll + Chirpy",
    "url": "/posts/jekyll-chirpy/",
    "categories": "åšå®¢",
    "tags": "Jekyll",
    "date": "2024-05-31 13:38:00 +0800",
    





    
    "snippet": "  å®‰è£… Jekyll (Ubuntu 24.04)          å…ˆè£… Ruby å’Œç›¸å…³ä¾èµ–é¡¹: sudo apt-get install ruby-full build-essential zlib1g-dev              è®¾ç½®å½“å‰ç”¨æˆ·æœ‰ gem çš„æ‰§è¡Œæƒé™          echo '# Install Ruby Gems to ~/gems' &gt;&gt; ~...",
    "content": "  å®‰è£… Jekyll (Ubuntu 24.04)          å…ˆè£… Ruby å’Œç›¸å…³ä¾èµ–é¡¹: sudo apt-get install ruby-full build-essential zlib1g-dev              è®¾ç½®å½“å‰ç”¨æˆ·æœ‰ gem çš„æ‰§è¡Œæƒé™          echo '# Install Ruby Gems to ~/gems' &gt;&gt; ~/.bashrc  echo 'export GEM_HOME=\"$HOME/gems\"' &gt;&gt; ~/.bashrc  echo 'export PATH=\"$HOME/gems/bin:$PATH\"' &gt;&gt; ~/.bashrc  source ~/.bashrc                    å®‰è£… Jekyll: gem install jekyll bundler        ä½¿ç”¨ Chirpy ä¸»é¢˜          Clone æˆ–ä¸‹è½½ https://github.com/cotes2020/chirpy-starter ä»“åº“      å®‰è£…ä¾èµ–ï¼š bundle      å¯åŠ¨é¡¹ç›®ï¼š bundle exec jekyll s      è®¿é—®ï¼šhttp://localhost:4000        åŸºæœ¬é…ç½®åŠå†™ post          https://chirpy.cotes.page/posts/getting-started/      https://chirpy.cotes.page/posts/write-a-new-post/        åˆæ¬¡æ„Ÿå—          æ¸…æ–°ç®€æ´ï¼Œå¤§æ–¹ç¾è§‚ï¼Œå“åº”è¿…é€Ÿ      å®šåˆ¶é¡¹æŒºå¤šï¼Œæ”¯æŒè§†é¢‘/éŸ³é¢‘ç­‰åª’ä½“æ ¼å¼      ä»è‡ªå·±å¹³æ—¶å†™çš„ Markdown æ–‡ä»¶è½¬æ¢è¿‡æ¥è¦æ”¹é€ çš„å†…å®¹ä¹ŸæŒºå¤šçš„ï¼Œ å¯ä»¥è€ƒè™‘å†™ä¸ªç¨‹åºåšè¿™ä¸ªäº‹æƒ…      å…¶ä»–æ›´ç»†è‡´çš„ä½“éªŒå¾…è‡ªå·±æ·±å…¥ä½¿ç”¨å†è¯„ä»·            Changelog          å‡†å¤‡ä½¿ç”¨è¿™ä¸ªä½œä¸ºè‡ªå·±çš„åšå®¢æ¡†æ¶ï¼Œå…ˆæŠŠåšå®¢å†™èµ·æ¥å†è°ˆå…¶ä»–              å¤´åƒ/è”ç³»æ–¹å¼ç­‰è®¾ç½®        favicon æ›¿æ¢        æ¥å…¥ giscus è¯„è®ºç³»ç»Ÿ - martinâ€˜s blog        æ¥å…¥ Google Analytics        å›½å†…ç½‘ç»œç¯å¢ƒåŠ é€Ÿ - æ˜¯å¦æœ‰å¿…è¦ï¼Ÿ è¿˜æ˜¯å…ˆè¾“å‡ºå†…å®¹ä¸ºä¸»ï¼Œä¸åšè¿‡æ—©ä¼˜åŒ–ã€‚              å’Œ Gmeek çš„ç®€å•å¯¹æ¯”          ä¹‹å‰çš„åšå®¢æ¡†æ¶ä¸»è¦æ ¹æ® GitHub Issue as a Blog å’Œ Gmeek å¿«é€Ÿä¸Šæ‰‹ æ„å»ºçš„ã€‚      Gmeek æ˜¯åŸºäº GitHub Issues çš„ï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ç®€æ´, ç„¶åæ˜¯éƒ½åŸºäº GitHub å¹³å°ï¼Œä¸ç”¨åœ¨æœ¬åœ°å®‰è£…å„ç§ç¯å¢ƒï¼Œé‡åˆ°çš„æœ€å¤§é—®é¢˜æ˜¯ä¹‹å‰ Gmeek æä¾›çš„ Github Action è„šæœ¬ä¸å…¼å®¹ï¼Œå¯¼è‡´åç»­çš„æ„å»ºå¤±è´¥ã€‚      Chirpy å¯¹äº Gmeek çš„è¯ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰é¡µé¢å¸ƒå±€è¦å¥½ä¸€ç‚¹ï¼Œå¯é…ç½®çš„åœ°æ–¹ä¹Ÿè¦ä¸°å¯Œä¸€ç‚¹ã€‚      "
  },
  
  {
    "title": "GraalVM Native + Base64 ç¼–è§£ç å‘½ä»¤è¡Œå°å·¥å…·å¼€å‘",
    "url": "/posts/graalvm-native-java-base64-command-line-tool/",
    "categories": "æŠ€æœ¯, Java",
    "tags": "GraalVM, Java, JShell",
    "date": "2024-04-29 13:38:00 +0800",
    





    
    "snippet": "  åˆè¡·ï¼š          æµè§ˆ  V ç«™ å¸–å­æœ‰å¾ˆå¤š Base64 åŠ å¯†çš„ä¿¡æ¯ï¼Œå¸Œæœ›èƒ½å¤Ÿå¿«é€Ÿè§£å¯†ã€‚        å®ç°ï¼š                  v1ï¼šç›´æ¥ä½¿ç”¨ JShell å‘½ä»¤è¡Œè¿è¡Œ Java ä»£ç è§£å¯†          ant@ant:~$ jshell   |  Welcome to JShell -- Version 17.0.9  |  For an introdu...",
    "content": "  åˆè¡·ï¼š          æµè§ˆ  V ç«™ å¸–å­æœ‰å¾ˆå¤š Base64 åŠ å¯†çš„ä¿¡æ¯ï¼Œå¸Œæœ›èƒ½å¤Ÿå¿«é€Ÿè§£å¯†ã€‚        å®ç°ï¼š                  v1ï¼šç›´æ¥ä½¿ç”¨ JShell å‘½ä»¤è¡Œè¿è¡Œ Java ä»£ç è§£å¯†          ant@ant:~$ jshell   |  Welcome to JShell -- Version 17.0.9  |  For an introduction type: /help intro          jshell&gt; var enc = \"c2F2ZW9sZQ==\"  enc ==&gt; \"c2F2ZW9sZQ==\"          jshell&gt; var decodedBytes = Base64.getDecoder().decode(enc.getBytes())  decodedBytes ==&gt; byte[8] { 115, 97, 118, 101, 95, 111, 108, 101 }          jshell&gt; new String(decodedBytes)  $3 ==&gt; \"saveole\"                            v2ï¼šGraalVM Native çš„æ–¹å¼å°† Java ç¨‹åºç¼–è¯‘æ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶å°å·¥å…·                              åŸ Java ç¨‹åºï¼š              import java.util.Base64;              public class Base64Tool {      static String helpMsg = \"\"\"  \t\t-e Encode input string  \t\t-d Decode input string               \"\"\";;                      public static void main(String[] args) {          if (args == null || args.length == 0) {              System.err.println(helpMsg);              System.exit(1);          }          var arg = args[0];          switch(arg) {            case \"-help\":                System.out.println(helpMsg);                break;            case \"-e\":                var toEncode = getAndCheckArg(args);                System.out.println(new String(Base64.getEncoder().encode(toEncode.getBytes())));                break;            case \"-d\":                var toDecode = getAndCheckArg(args);                System.out.println(new String(Base64.getDecoder().decode(toDecode.getBytes())));                break;            default:                System.err.println(\"Unknown command, use -help to see how to use this tool.\");                break;          }          System.exit(1);      }                  static String getAndCheckArg(String[] args) {          if (args == null || args.length &lt; 2) {              System.err.println(\"Please input valid string\");              System.exit(0);          }          return args[1];      }  }                                            ä½¿ç”¨ native-image ç¼–è¯‘æ„å»ºå¯æ‰§è¡Œç¨‹åº              ant@ant:~/native$ javac Base64Tool.java   ant@ant:~/native$ native-image Base64Tool  ========================================================================================================================  GraalVM Native Image: Generating 'base64tool' (executable)...  ========================================================================================================================  [1/8] Initializing...                                                                                    (1.7s @ 0.14GB)   Java version: 17.0.9+9, vendor version: GraalVM CE 17.0.9+9.1   Graal compiler: optimization level: 2, target machine: x86-64-v3   C compiler: gcc (linux, x86_64, 11.4.0)   Garbage collector: Serial GC (max heap size: 80% of RAM)  [2/8] Performing analysis...  [****]                                                                     (4.4s @ 0.27GB)     2,912 (71.67%) of  4,063 types reachable     3,536 (50.94%) of  6,942 fields reachable    13,209 (43.86%) of 30,116 methods reachable       907 types,     0 fields, and   348 methods registered for reflection        58 types,    58 fields, and    52 methods registered for JNI access         4 native libraries: dl, pthread, rt, z  [3/8] Building universe...                                                                               (0.9s @ 0.30GB)  [4/8] Parsing methods...      [*]                                                                        (0.6s @ 0.32GB)  [5/8] Inlining methods...     [***]                                                                      (0.5s @ 0.22GB)  [6/8] Compiling methods...    [**]                                                                       (4.5s @ 0.35GB)  [7/8] Layouting methods...    [*]                                                                        (0.7s @ 0.37GB)  [8/8] Creating image...       [*]                                                                        (1.1s @ 0.38GB)     4.42MB (36.75%) for code area:     7,506 compilation units     7.04MB (58.46%) for image heap:   89,275 objects and 5 resources   590.55kB ( 4.79%) for other data    12.03MB in total  ------------------------------------------------------------------------------------------------------------------------  Top 10 origins of code area:                                Top 10 object types in image heap:     3.37MB java.base                                         1009.70kB byte[] for code metadata   795.13kB svm.jar (Native Image)                             889.53kB java.lang.String   112.32kB java.logging                                       836.32kB byte[] for general heap data    62.07kB org.graalvm.nativeimage.base                       671.94kB java.lang.Class    24.15kB jdk.internal.vm.ci                                 665.65kB byte[] for java.lang.String    23.14kB org.graalvm.sdk                                    347.48kB java.util.HashMap$Node     6.11kB jdk.internal.vm.compiler                           250.25kB com.oracle.svm.core.hub.DynamicHubCompanion     1.68kB Base64Tool                                         169.02kB java.lang.String[]     1.35kB jdk.proxy1                                         165.57kB java.lang.Object[]     1.27kB jdk.proxy3                                         148.84kB byte[] for embedded resources     1.56kB for 2 more packages                                  1.20MB for 829 more object types  ------------------------------------------------------------------------------------------------------------------------  Recommendations:   HEAP: Set max heap for improved and more predictable memory usage.   CPU:  Enable more CPU features with '-march=native' for improved performance.  ------------------------------------------------------------------------------------------------------------------------                          0.7s (4.3% of total time) in 164 GCs | Peak RSS: 0.84GB | CPU load: 8.21  ------------------------------------------------------------------------------------------------------------------------  Produced artifacts:   /home/ant/native/base64tool (executable)  ========================================================================================================================  Finished generating 'base64tool' in 14.8s.                                            ä½¿ç”¨              ant@ant:~/native$ ./base64tool -help  -e Encode input string  -d Decode input string              ant@ant:~/native$ ./base64tool -e saveole  c2F2ZW9sZQ==  ant@ant:~/native$ ./base64tool -d c2F2ZW9sZQ==  saveole  ant@ant:~/native$                                             æ³¨æ„äº‹é¡¹          ä½¿ç”¨ native-image æ„å»ºå¯æ‰§è¡Œç¨‹åºæ—¶ï¼Œéœ€è¦æ³¨æ„å½“å‰çš„æ‰§è¡Œç›®å½•ã€‚å®ƒé»˜è®¤ä¼šæ‰«æå½“å‰ç›®å½•åŠå­ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶(ä¸èƒ½åŒºåˆ† Java ç¨‹åºç›¸å…³çš„æ–‡ä»¶)ï¼Œå¯¼è‡´æ„å»ºå¤±è´¥ã€‚å»ºè®®åœ¨å•ç‹¬çš„æ–‡ä»¶å¤¹ä¸­è¿›è¡Œç¼–è¯‘æ„å»ºã€‚      "
  },
  
  {
    "title": "Spring Native åˆä½“éªŒ",
    "url": "/posts/spring-native-first-cup/",
    "categories": "æŠ€æœ¯, Java",
    "tags": "Docker, JVM, Java, GraalVM",
    "date": "2024-04-07 13:30:30 +0800",
    





    
    "snippet": "  é¡¹ç›®èƒŒæ™¯          mqtt çš„æ¶ˆè´¹ç«¯åº”ç”¨ï¼Œåº”ç”¨é€»è¾‘è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯æ¶ˆè´¹ mqtt æ¶ˆæ¯ï¼Œç„¶ååšå¯¹åº”çš„æŒä¹…åŒ–(å†™å¤šè¯»å°‘)æ“ä½œ      é¡¹ç›®æ¶æ„ä¸»è¦ä½¿ç”¨åˆ°äº† Spring Boot ä½œä¸º IoC å®¹å™¨ï¼ŒMongoDB ä½œä¸ºå­˜å‚¨ï¼Œç„¶åå¼€æºçš„ mqtt-spring-boot-starter ä½œä¸º mqtt å®¢æˆ·ç«¯      å½“å‰å­˜åœ¨çš„é—®é¢˜ï¼š                  è¿‡åº¦ä¾èµ–...",
    "content": "  é¡¹ç›®èƒŒæ™¯          mqtt çš„æ¶ˆè´¹ç«¯åº”ç”¨ï¼Œåº”ç”¨é€»è¾‘è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯æ¶ˆè´¹ mqtt æ¶ˆæ¯ï¼Œç„¶ååšå¯¹åº”çš„æŒä¹…åŒ–(å†™å¤šè¯»å°‘)æ“ä½œ      é¡¹ç›®æ¶æ„ä¸»è¦ä½¿ç”¨åˆ°äº† Spring Boot ä½œä¸º IoC å®¹å™¨ï¼ŒMongoDB ä½œä¸ºå­˜å‚¨ï¼Œç„¶åå¼€æºçš„ mqtt-spring-boot-starter ä½œä¸º mqtt å®¢æˆ·ç«¯      å½“å‰å­˜åœ¨çš„é—®é¢˜ï¼š                  è¿‡åº¦ä¾èµ–ï¼šä¾èµ–äº† Spring Web ç­‰æœ¬ä¸éœ€è¦çš„ä¾èµ–(è¿™é‡Œçš„ Spring ä¸»è¦ä½œä¸º bean å®¹å™¨)          å¼¹æ€§ä¸è¶³ï¼šå½“æ¶ˆè´¹èƒ½åŠ›ä¸è¶³éœ€è¦æ·»åŠ å®ä¾‹çš„æ—¶å€™ï¼Œåº”ç”¨å¯åŠ¨é€Ÿåº¦ä¸å¤Ÿå¿« + é•œåƒä½“ç§¯è¾ƒå¤§(451M)          åŸºäºspring boot fat jar çš„åº”ç”¨å†…å­˜å ç”¨è¾ƒé«˜                      ç¯å¢ƒ          OS: Ubuntu 22.04      JDK: openjdk 21 GraalVM CE 21+35.1      IDE: IDEA Ultimate 2023.2.5      CPU: i5-12400      å†…å­˜: 32G 2666Hz        æ”¹é€ å†…å®¹          JDK 17 â†’ 21      Spring Boot 2.7.0 â†’ 3.3.0      Spring AOT      Dockerfile        å­˜åœ¨é—®é¢˜          build é˜¶æ®µé—®é¢˜                  commons-logging ä¸ spring jcl çš„å†²çª  â†’ å»é™¤å¯¹åº”çš„ commons-logging åŒ…                    runtime é˜¶æ®µé—®é¢˜                  profiles é—®é¢˜          Java 21 ResourceBundle  â†’ Caused by: java.util.MissingResourceException: Can't find bundle for base name oss, locale en_US                          ç”± ali-sdk-oss å¼•å…¥ï¼Œå‘ç°é¡¹ç›®ä¸­æ²¡ç”¨åˆ°ï¼Œç§»é™¤ä¾èµ–                                è¿è¡Œæ—¶ hutool ReflectUtil ä½¿ç”¨æŠ¥é”™                          æ”¹ç”±æ”¹å†™ä¾èµ–çš„å¼€æºä¸‰æ–¹åº“å®ç°ï¼Œé¿å…ä½¿ç”¨reflection              mqtt-spring-boot-starter å‡çº§ç‰ˆæœ¬åæœªå‡ºç°                                mqtt-client å‘¨æœŸæ€§æ–­è¿/é‡è¿          whether JVM Runtime shutdown hook is executed when spring native app exited                    CI/CD                  ç›®å‰é˜¿é‡Œäº‘æµæ°´çº¿é…ç½®é»˜è®¤ä¸æ”¯æŒï¼Œæµæ°´çº¿é›†ç¾¤é»˜è®¤ä½¿ç”¨çš„é…ç½®æ˜¯ 1C1G æœºå™¨ã€‚          å°†è‡ªå·±çš„ ecs ä¸»æœºä½œä¸ºæ„å»ºæœºå™¨ï¼Œå‘ç° 2g çš„å†…å­˜ä¸è¶³ä»¥è¿›è¡Œåº”ç”¨æ„å»ºï¼Œå¯è§ aot æ„å»ºçš„è¿‡ç¨‹æ˜¯å¾ˆè€—èµ„æºçš„ã€‚                      æ€»ç»“ä½“éªŒ          èµ„æºå ç”¨å¯¹æ¯”                                å¯¹æ¯”é¡¹          jar          native                                      å†…å­˜å ç”¨          212672          7312                          æ–‡ä»¶å¤§å°          28.7M          91.7M                          é•œåƒå¤§å°          320M          126M                          å¯åŠ¨æ—¶é—´          1.034s          0.077s                            å…¶ä»–æ›´è¯¦ç»†çš„ä¿¡æ¯è§ï¼šchat      "
  },
  
  {
    "title": "Win10 Docker ç¯å¢ƒå®‰è£…åŠè®¾ç½®",
    "url": "/posts/win10-docker-desktop-install-and-setting/",
    "categories": "æŠ€æœ¯, Docker",
    "tags": "Docker",
    "date": "2023-05-19 13:30:30 +0800",
    





    
    "snippet": "      å‰ç½®æ­¥éª¤                                                      å®‰è£… WSL2 - [å®‰è£… WSL              Microsoft Learn](https://learn.microsoft.com/zh-cn/windows/wsl/install)                               ...",
    "content": "      å‰ç½®æ­¥éª¤                                                      å®‰è£… WSL2 - [å®‰è£… WSL              Microsoft Learn](https://learn.microsoft.com/zh-cn/windows/wsl/install)                                          åœ¨ è®¾ç½® &gt; åº”ç”¨ &gt; ç¨‹åºå’ŒåŠŸèƒ½ &gt; å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½ ä¸­å‹¾é€‰ Hyper-V å’Œ é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ      é‡å¯ç”µè„‘              å®‰è£… Linux å‘è¡Œç‰ˆ          # åˆ—å‡ºå¯ç”¨ linux å‘è¡Œç‰ˆæœ¬  wsl --list --online  # å®‰è£…é€‰å®šå‘è¡Œç‰ˆ  wsl --install -d &lt;Distribution Name&gt;  # æŸ¥çœ‹ wsl å®‰è£…ä¿¡æ¯  wsl -l -v                      ä¸‹è½½ Docker Desktop for Windows å¹¶å®‰è£…      Docker Desktop é»˜è®¤å®‰è£…åˆ° C ç›˜ï¼Œå¯ä»¥å°†å®ƒçš„æ•°æ®å­˜å‚¨åˆ°å…¶ä»–ç›˜      # å…ˆå¤‡ä»½ docker-desktop å’Œ docker-desktop-data æ•°æ®  wsl --export docker-desktop docker-desktop.tar  wsl --export docker-desktop-data docker-desktop-data.tar      # å¸è½½ wsl ä¸­çš„ docker-desktop å’Œ docker-desktop-data  wsl --unregister docker-desktop  wsl --unregister docker-desktop-data      # åœ¨å…¶ä»–ç›˜åˆ›å»ºå­˜å‚¨ç›®å½•å¹¶å¯¼å…¥ä¹‹å‰çš„æ•°æ®  wsl --import docker-desktop D:\\data\\docker-desktop docker-desktop.tar  wsl --import docker-desktop-data D:\\data\\docker-desktop-data docker-desktop-data.tar        é‡å¯ç”µè„‘  é‡åˆ°çš„é—®é¢˜                  docker desktop å¸è½½é‡è£…åä¸èƒ½å¯åŠ¨          åŸå› ï¼šæ²¡æœ‰åœ¨ å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½ ä¸­å‹¾é€‰ Hyper-V                            wsl â€”list â€”online ä¸€ç›´æ²¡æœ‰å“åº”          å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½ è®¾ç½®å˜æ›´åéœ€è¦é‡å¯ç”µè„‘ç”Ÿæ•ˆ                            "
  },
  
  {
    "title": "Spring Boot MVC è‡ªå®šä¹‰å‚æ•°è§£æå™¨",
    "url": "/posts/spring-mvc-customized-method-argument-resolver/",
    "categories": "æŠ€æœ¯, Java",
    "tags": "Spring, Java, Spring Web MVC",
    "date": "2023-05-09 13:30:30 +0800",
    





    
    "snippet": "èƒŒæ™¯  é—ç•™ç³»ç»Ÿï¼šé—ç•™æ¥å£ç³»ç»Ÿä¸º Golang + Gin + MongoDB å®ç°, MongoDB collection çš„ field å­—æ®µä¸ºä¸­æ–‡åè€Œä¸”ä¸å›ºå®š(å¯ä»¥é€šè¿‡ excel æ–‡ä»¶è‡ªå®šä¹‰è¡¨å¤´çš„å½¢å¼æ·»åŠ ), æŸ¥è¯¢å‚æ•°æ˜¯ç›´æ¥ä¼ çš„ä¸­æ–‡å½¢å¼, è€Œä¸”ä¼ å‚ä¸å›ºå®š(queryå‚æ•°çš„ key å’Œ value éƒ½ä¸å›ºå®š)ï¼Œå¦‚ï¼š/api/v1/customers?å§“å=å¼ ä¸‰&amp;å½•å…¥æ—¶é—´=202...",
    "content": "èƒŒæ™¯  é—ç•™ç³»ç»Ÿï¼šé—ç•™æ¥å£ç³»ç»Ÿä¸º Golang + Gin + MongoDB å®ç°, MongoDB collection çš„ field å­—æ®µä¸ºä¸­æ–‡åè€Œä¸”ä¸å›ºå®š(å¯ä»¥é€šè¿‡ excel æ–‡ä»¶è‡ªå®šä¹‰è¡¨å¤´çš„å½¢å¼æ·»åŠ ), æŸ¥è¯¢å‚æ•°æ˜¯ç›´æ¥ä¼ çš„ä¸­æ–‡å½¢å¼, è€Œä¸”ä¼ å‚ä¸å›ºå®š(queryå‚æ•°çš„ key å’Œ value éƒ½ä¸å›ºå®š)ï¼Œå¦‚ï¼š/api/v1/customers?å§“å=å¼ ä¸‰&amp;å½•å…¥æ—¶é—´=2022-09-01 00:00:00&amp;å½•å…¥æ—¶é—´=2022-09-02 23:59:59  é—®é¢˜ï¼šgo å·¥ç¨‹å¸ˆç¦»èŒ, åç«¯åªæœ‰ java å·¥ç¨‹å¸ˆçš„æƒ…å†µä¸‹ï¼Œå°†æ­¤æ¥å£æ”¹ç”¨ java é‡å†™ä¸€éï¼Œä½†ä¼ å‚æ–¹å¼ä¸å˜(query key è¿˜æ˜¯ä¸ºä¸­æ–‡)å®ç°å¯é€‰æ–¹æ¡ˆ  æ–¹æ¡ˆä¸€ï¼šä¸ç”¨ java æ”¹å†™ï¼Œjava å·¥ç¨‹å¸ˆç»´æŠ¤ golang é¡¹ç›®          ä¼˜ç‚¹ï¼šä»£ç æ”¹åŠ¨æœ€å°ï¼Œå‡ºç° bug çš„æ¦‚ç‡ä¹Ÿæœ€å°      ç¼ºç‚¹ï¼šéœ€è¦èŠ±æ—¶é—´å­¦ä¹  go è¯­è¨€å’Œç›¸å…³é¡¹ç›®        æ–¹æ¡ˆäºŒï¼šè·å– HttpServletRequset å¯¹è±¡, åœ¨ç›¸åº”çš„æ¥å£å…¥å£å±‚è¿›è¡Œå‚æ•°å¤„ç†          ä¼˜ç‚¹ï¼šèƒ½å¤Ÿè·å–åˆ°æ‰€æœ‰å‚æ•°ï¼Œå¿«é€Ÿå®ç°åŠŸèƒ½      ç¼ºç‚¹ï¼šé’ˆå¯¹ç‰¹å®šæ¥å£å®ç°ï¼Œä¸åˆ©äºä»£ç æ‰©å±•        æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰ MVC å±‚å‚æ•°è§£æå™¨è§£æè¯·æ±‚å‚æ•°å¹¶ç»‘å®š          ä¼˜ç‚¹ï¼šèƒ½å¤ŸæŠ½å–æ­¤ç±»éœ€æ±‚çš„å…¬å…±å‚æ•°,ç»“åˆåå°„å’Œæ³¨è§£æœºåˆ¶åˆ©äºç›¸ä¼¼éœ€æ±‚çš„æ‰©å±•      ç¼ºç‚¹ï¼šç›¸å¯¹äºæ–¹æ¡ˆäºŒæ€§èƒ½å¯èƒ½ä¼šå·®ä¸€ç‚¹ã€‚                  æ¶‰åŠåˆ°åå°„å¤„ç†                    æ–¹æ¡ˆä¸‰å®ç°  MVC æ–¹æ³•å‚æ•°å¤„ç†å™¨æ¥å£ HandlerMethodArgumentResolverpublic interface HandlerMethodArgumentResolver {\t/**\t * æ­¤è§£æå™¨æ˜¯å¦æ”¯æŒè¯¥æ–¹æ³•å‚æ•°çš„è§£æ\t */\tboolean supportsParameter(MethodParameter parameter);\t/**\t * å°†æ‹¿åˆ°çš„åŸå§‹æ•°æ®è§£ææˆæƒ³è¦çš„å‚æ•°å¯¹è±¡\t * A {@link ModelAndViewContainer} provides access to the model for the\t * request. A {@link WebDataBinderFactory} provides a way to create\t * a {@link WebDataBinder} instance when needed for data binding and\t * type conversion purposes.\t * @param parameter the method parameter to resolve. This parameter must\t * have previously been passed to {@link #supportsParameter} which must\t * have returned {@code true}.\t * @param mavContainer the ModelAndViewContainer for the current request\t * @param webRequest the current request\t * @param binderFactory a factory for creating {@link WebDataBinder} instances\t * @return the resolved argument value, or {@code null} if not resolvable\t * @throws Exception in case of errors with the preparation of argument values\t */\t@Nullable\tObject resolveArgument(MethodParameter parameter, @Nullable ModelAndViewContainer mavContainer,\t\t\tNativeWebRequest webRequest, @Nullable WebDataBinderFactory binderFactory) throws Exception;}  å®ç°è‡ªå®šä¹‰æ–¹æ³•å‚æ•°å¤„ç†å™¨@Slf4jpublic class ZhFieldRequestResolver implements HandlerMethodArgumentResolver {    @Override    public boolean supportsParameter(MethodParameter parameter) {        // æœ‰ ZhBindConvertor æ³¨è§£çš„å‚æ•°æ‰è¿›è¡Œè§£æè½¬æ¢        return parameter.hasParameterAnnotation(ZhBindConvertor.class);    }    @Override    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer,                                  NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {        HttpServletRequest request = webRequest.getNativeRequest(HttpServletRequest.class);        assert request != null;        // è·å–å‚æ•°ç±»å‹ï¼Œæ ¹æ®å‚æ•°ç±»å‹åå°„åˆ›å»ºç±»å‹å®ä¾‹        Class&lt;?&gt; resultType = parameter.getParameterType();        return buildResultObject(resultType, request);    }    private Object buildResultObject(Class&lt;?&gt; resultType, HttpServletRequest request) throws InvocationTargetException,            NoSuchMethodException, InstantiationException, IllegalAccessException, IOException {        String method = request.getMethod();        // æ ¹æ®ä¸åŒçš„ http æ–¹æ³•ï¼Œä½¿ç”¨ä¸åŒçš„å‚æ•°æ„å»ºæ¨¡å¼        return switch (method) {            case \"POST\" -&gt; buildResultObjectForPost(resultType, request);            case \"GET\" -&gt; buildResultObjectForGet(resultType, request);            default -&gt; throw new IllegalStateException(\"ä¸æ”¯æŒçš„ http æ–¹æ³•ç±»å‹: \" + method);        };    }    /**     * GET æ–¹æ³•ç›´æ¥é€šè¿‡ {@link ServletRequest#getParameterMap()} æ–¹æ³•è·å–è¯·æ±‚å‚æ•°     */    private Object buildResultObjectForGet(Class&lt;?&gt; resultType, HttpServletRequest request) throws NoSuchMethodException,            InvocationTargetException, InstantiationException, IllegalAccessException {        Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();        Map&lt;String, List&lt;String&gt;&gt; pMap = new HashMap&lt;&gt;();        parameterMap.forEach((k, v) -&gt; pMap.put(k, List.of(v)));        Field[] fields = resultType.getDeclaredFields();        Class&lt;?&gt; superclass = resultType.getSuperclass();        Field[] superFields = null;        if (!superclass.equals(Object.class)) {            superFields = superclass.getDeclaredFields();        }        // åå°„å®ä¾‹åŒ–å‚æ•°å¯¹è±¡                Object instance = resultType.getDeclaredConstructor(null).newInstance(null);        // å¡«å……å¯¹è±¡å­—æ®µä¿¡æ¯                setFieldsForGet(fields, instance, parameterMap, pMap);        if (superFields != null) {            setFieldsForGet(superFields, instance, parameterMap, pMap);        }        return instance;    }    /**     * é€šè¿‡ field type æ¥è®¾ç½®å¯¹åº”çš„å­—æ®µå€¼     * https://docs.oracle.com/javase/tutorial/reflect/member/fieldTypes.html     */    private void setFieldsForGet(Field[] fields, Object instance, Map&lt;String, String[]&gt; parameterMap, Map&lt;String,            List&lt;String&gt;&gt; pMap) throws IllegalAccessException {        for (Field f : fields) {            f.setAccessible(true);            String typeName = f.getGenericType().getTypeName();            ZhBindAlias bindAlias = f.getAnnotation(ZhBindAlias.class);            if (Objects.nonNull(bindAlias)) {                String name = bindAlias.value();                int index = bindAlias.index();                String[] values = parameterMap.get(name);                if (values != null &amp;&amp; values.length &gt; 0) {                    Object convertValue = FieldTypeConvertor.FieldType.of(typeName).convert(values, index);                    f.set(instance, convertValue);                }                pMap.remove(name);                if (\"extras\".equals(f.getName()) &amp;&amp; !pMap.isEmpty()) {                    f.set(instance, pMap);                }            } else {                String[] values = parameterMap.get(f.getName());                if (values != null &amp;&amp; values.length &gt; 0) {                    Object convertValue = FieldTypeConvertor.FieldType.of(typeName).convertFirst(values);                    f.set(instance, convertValue);                }                pMap.remove(f.getName());            }        }    }    /**     * POST æ–¹æ³•é€šè¿‡è·å–è¯·æ±‚ä½“ json å­—ç¬¦ä¸²è½¬è¯·æ±‚å¯¹è±¡çš„æ–¹å¼è·å–å‚æ•°ä¿¡æ¯     */    private Object buildResultObjectForPost(Class&lt;?&gt; resultType, HttpServletRequest request) throws NoSuchMethodException,            InvocationTargetException, InstantiationException, IllegalAccessException, IOException {        // éªŒè¯ header çš„ Content-Type ä¸º application/json æ‰èƒ½è¿›è¡Œåç»­æ“ä½œ        String contentTypeHeader = request.getHeader(HttpHeaders.CONTENT_TYPE);        if (StringUtils.isBlank(contentTypeHeader) || !contentTypeHeader.equals(MediaType.APPLICATION_JSON_VALUE)) {            throw new IllegalStateException(\"è¯·è®¾ç½® Content-Type å€¼ä¸º application/json\");        }        Field[] fields = resultType.getDeclaredFields();        Class&lt;?&gt; superclass = resultType.getSuperclass();        Field[] superFields = null;        if (!superclass.equals(Object.class)) {            superFields = superclass.getDeclaredFields();        }        Object instance = resultType.getDeclaredConstructor(null).newInstance(null);        StringBuilder sb = new StringBuilder();        try (BufferedReader reader = request.getReader()) {            String line = reader.readLine();            while (StringUtils.isNotBlank(line)) {                sb.append(line);                line = reader.readLine();            }            log.info(\"uri:{},è¯·æ±‚ä½“å‚æ•°:{}\", request.getRequestURI(), sb);            JSONObject body = JSON.parseObject(sb.toString());            setFields(fields, body, instance);            setFields(superFields, body, instance);        }        return instance;    }    private void setFields(Field[] fields, JSONObject source, Object target) throws IllegalAccessException {        if (Objects.isNull(fields) || fields.length == 0) return;        for (Field f : fields) {            f.setAccessible(true);            String fName = f.getName();            String typeName = f.getGenericType().getTypeName();            ZhBindAlias bindAlias = f.getAnnotation(ZhBindAlias.class);            if (Objects.nonNull(bindAlias)) {                String name = bindAlias.value();                int index = bindAlias.index();                Object o = source.get(name);                if (\"extras\".equals(fName)) {                    f.set(target, jsonObjectToMap(source));                }                if (Objects.isNull(o)) continue;                Object convertValue = FieldTypeConvertor.FieldType.of(typeName).convertJsonObject(o, index, name);                f.set(target, convertValue);                source.remove(name);            } else {                Object o = source.get(fName);                if (Objects.isNull(o)) continue;                Object convertValue = FieldTypeConvertor.FieldType.of(typeName).convertJsonObject(o, 0, fName);                f.set(target, convertValue);                source.remove(fName);            }        }    }    private Map&lt;String, List&lt;String&gt;&gt; jsonObjectToMap(JSONObject object) {        TypeReference&lt;List&lt;String&gt;&gt; type = new TypeReference&lt;&gt;(){};        Map&lt;String, List&lt;String&gt;&gt; value = new HashMap&lt;&gt;();        object.forEach((k, v) -&gt; {            List&lt;String&gt; list = JSON.parseObject(v.toString(), type);            value.put(k, list);        });        return value;    }}  é…ç½® WebMvcConfigurer ä½¿è‡ªå®šä¹‰å‚æ•°è§£æå™¨ç”Ÿæ•ˆ@Configurationpublic class WebConfig implements WebMvcConfigurer {    @Override    public void addArgumentResolvers(List&lt;HandlerMethodArgumentResolver&gt; resolvers) {        resolvers.add(new ZhFieldRequestResolver());    }}  è‡ªå®šä¹‰æ³¨è§£ç”¨äºæ ‡æ³¨è§£æåçš„å‚æ•°æ¥æ”¶ç±»/** * ä¸­æ–‡è¯·æ±‚å‚æ•°è½¬æ¢,è¯·æ±‚å®ä½“å­—æ®µé…åˆ {@link ZhBindAlias} ä½¿ç”¨ * å®ç°åŸç†ï¼šè‡ªå®šä¹‰å®ç° mvc å‚æ•°è½¬æ¢å™¨ {@link org.springframework.web.method.support.HandlerMethodArgumentResolver} */@Documented@Target(ElementType.PARAMETER)@Retention(RetentionPolicy.RUNTIME)public @interface ZhBindConvertor {    boolean required() default true;}@Target(ElementType.FIELD)@Retention(RetentionPolicy.RUNTIME)public @interface ZhBindAlias {    /** å­—æ®µçš„ä¸­æ–‡åˆ«å */    String value();    /** åŒåçš„æƒ…å†µä¸‹ç»‘å®šåˆ°ç¬¬å‡ ä¸ªå‚æ•° */    int index() default 0;    /** æ˜¯å¦é»˜è®¤æ·»åŠ åˆ° query æ¡ä»¶æ„å»ºä¸­ */    boolean includeQuery() default true;}  æŠ½å–å…¬ç”¨æŸ¥è¯¢å‚æ•°ç±»/** * å…¬å…±æŸ¥è¯¢å‚æ•° */@Datapublic abstract class ZhSearchReq {    @ZhBindAlias(\"å½•å…¥æ—¶é—´\")    private String startTime;    @ZhBindAlias(value = \"å½•å…¥æ—¶é—´\", index = 1)    private String endTime;    /** è‡ªå®šä¹‰æŸ¥è¯¢å­—æ®µ(å¯¹åº”å˜åŒ–çš„éƒ¨åˆ†) */    @ZhBindAlias(value = \"extra\", includeQuery = false)    private Map&lt;String, List&lt;String&gt;&gt; extras;    /**     * æ’åºå­—æ®µ, json å­—ç¬¦ä¸²ï¼Œç¤ºä¾‹ï¼š     * {â€œå½•å…¥æ—¶é—´â€: \"ascend\", \"åˆ†é…æ—¶é—´\": \"descend\"}     * æŒ‰å½•å…¥æ—¶é—´å‡åºï¼Œåˆ†é…æ—¶é—´é™åºæ’åˆ—ï¼Œé»˜è®¤å‡åº     */    private String sorter;    @Min(1)    @ZhBindAlias(value = \"current\", includeQuery = false)    private Integer current = 1;    @Min(1)    @ZhBindAlias(value = \"pageSize\", includeQuery = false)    private Integer pageSize = 50;    /** é»˜è®¤æŒ‰å½•å…¥æ—¶é—´é™åºæ’åˆ— */    private Sort defaultSort() {        return Sort.by(\"å½•å…¥æ—¶é—´\").descending();    }    /**     * è·å–å­ç±»å­—æ®µçš„å€¼,å­ç±»éœ€è¦æœ‰ getter æ–¹æ³•     * @deprecated     */    private void filedCriteriaForSubClass(Criteria criteria, Field f) {        Method[] methods = this.getClass().getDeclaredMethods();        String name = f.getName();        Stream.of(methods)                .filter(m -&gt; m.getName().startsWith(\"get\") &amp;&amp; m.getName().toLowerCase().contains(name.toLowerCase()))                .findAny()                .ifPresent(m -&gt; {                    try {                        Object value = m.invoke(this, null);                        // filedCriteria(criteria, f, value);                    } catch (IllegalAccessException e) {                        e.printStackTrace();                    } catch (InvocationTargetException e) {                        e.printStackTrace();                    }                });    }    public Sort sort() {        String sorter = getSorter();        if (StringUtils.isEmpty(sorter)) return defaultSort();        HashMap sorterMap = JSONObject.parseObject(sorter, HashMap.class);        if (sorterMap.isEmpty()) return defaultSort();        List&lt;Sort.Order&gt; orders = new ArrayList&lt;&gt;(sorterMap.size());        sorterMap.forEach((k, v) -&gt; {            Sort.Order order;            if (v.equals(\"descend\")) {                order = Sort.Order.desc(k.toString());            } else {                order = Sort.Order.asc(k.toString());            }            orders.add(order);        });        if (orders.isEmpty()) return defaultSort();        return Sort.by(orders);    }    /**     * ç”±äºæ•°æ®åº“é€‰å‹åŸå› ï¼Œä¸ MongoDB æŸ¥è¯¢æ¡ä»¶å¼ºç»‘å®š     */    public Criteria getQueryCriteria() {        Criteria criteria = new Criteria();        Class&lt;? extends ZhSearchReq&gt; reqClass = this.getClass();        Class&lt;?&gt; superclass = reqClass.getSuperclass();        Field[] superFields = new Field[0];        if (!superclass.equals(Object.class)) {            superFields = superclass.getDeclaredFields();        }        Field[] fields = reqClass.getDeclaredFields();        Arrays.stream(fields).forEach(f -&gt; filedCriteria(criteria, f));        Arrays.stream(superFields).forEach(f -&gt; filedCriteria(criteria, f));        if (StringUtils.isNotBlank(getStartTime()) &amp;&amp; StringUtils.isNotBlank(getEndTime())) {            criteria.and(\"å½•å…¥æ—¶é—´\").gte(getStartTime()).lte(getEndTime());        }        // å¯¹äºåŠ¨æ€å‚æ•°çš„å¤„ç†        if (MapUtil.isNotEmpty(extras)) {            extras.forEach((k, v) -&gt; {                if (CollUtil.isNotEmpty(v)) {                    // warning ä¸å…·ä½“ä¸šåŠ¡é€»è¾‘ç›¸å…³,å¯ä»¥å‰ç«¯ç¡®å®šå…¬ç”¨çš„å¤„ç†æ¨¡å‹                    if (!v.contains(\"å…¨é€‰\")) {                        if (v.size() == 1) {                            // æ ¹æ®ä¸šåŠ¡é€»è¾‘ç¡®å®šå•å€¼çš„æŸ¥è¯¢å®šä¹‰                            criteria.and(k).is(v.get(0));                        } else {                            // æ ¹æ®ä¸šåŠ¡é€»è¾‘ç¡®å®šå¤šå€¼çš„æŸ¥è¯¢å®šä¹‰                            criteria.and(k).in(v);                        }                    }                }            });        }        return criteria;    }    /**     * å¯¹äºå•ä¸ªæŸ¥è¯¢å‚æ•°çš„å¤„ç†     */    protected void filedCriteria(Criteria criteria, Field f) {        String fName = f.getName();        if (\"sorter\".equals(fName)) return;        String typeName = f.getGenericType().getTypeName();        ZhBindAlias alias = f.getAnnotation(ZhBindAlias.class);        Object value = null;        try {            f.setAccessible(true);            value = f.get(this);        } catch (IllegalAccessException e) {            // å†…éƒ¨è°ƒç”¨ï¼Œä¸ä¼šæœ‰é—®é¢˜            e.printStackTrace();        }        if (Objects.isNull(value)) return;        if (Objects.nonNull(alias)) {            if (!alias.includeQuery()) return;            String where = alias.value();            if (\"java.lang.String\".equals(typeName) &amp;&amp; !where.contains(\"æ—¶é—´\")) {                // å•å€¼é‡‡ç”¨å‰ç¼€åŒ¹é…æŸ¥è¯¢                criteria.and(where).regex(\"^\" + value);            } else if (\"java.util.List&lt;java.lang.String&gt;\".equals(typeName) &amp;&amp; !where.contains(\"æ—¶é—´\")) {                List&lt;String&gt; values = (List&lt;String&gt;) value;                if (!values.contains(\"å…¨é€‰\")) {                    // å¤šå€¼é‡‡ç”¨ $in æŸ¥è¯¢                    criteria.and(where).in(values);                }            }        } else {            // ç­‰å€¼æŸ¥è¯¢            criteria.and(fName).is(value);        }    }}  æ‰©å±•æŸ¥è¯¢å‚æ•°ç±»@Datapublic class CustomerSearchReq extends ZhSearchReq {    @ZhBindAlias(\"è·Ÿè¿›çŠ¶æ€\")    private List&lt;String&gt; followState;    @ZhBindAlias(\"æ‰‹æœºå·\")    private String mobile;    @ZhBindAlias(\"å§“å\")    private String name;}  ä½¿ç”¨@GetMapping()@Operation(summary = \"çº¿ç´¢åˆ—è¡¨\")public R&lt;PageResult&lt;LinkedHashMap&gt;&gt; searchPage(@ZhBindConvertor CustomerSearchReq searchReq) {    return R.ok(customerSearchService.search(searchReq));}  é‡æ„è´¨é‡ä¿è¯-æµ‹è¯•ç”¨ä¾‹          åªå†™äº†é›†æˆæµ‹è¯•ç”¨ä¾‹ï¼Œä¿è¯åŸºæœ¬çš„å…¨æµç¨‹å‡†ç¡®æ€§      æ€»ç»“æ¶‰åŠçŸ¥è¯†ç‚¹  Spring          SpringMVC å‚æ•°ç»‘å®šæµç¨‹åŠè‡ªå®šä¹‰å‚æ•°è§£æå™¨å®ç°                  GET ç±»å‹è¯·æ±‚å‚æ•°è§£æ          POST ç±»å‹è¯·æ±‚å‚æ•°è§£æ                    è‡ªå®šä¹‰å‚æ•°è§£æå™¨å¦‚ä½•é…ç½®ç”Ÿæ•ˆ        åå°„:          æ ¹æ®ç±»å‹å®ä¾‹åŒ–å¯¹è±¡      å­—æ®µä¿¡æ¯è·å–ä¸å¯¹è±¡å­—æ®µè®¾ç½®      å­—æ®µç±»å‹ä¿¡æ¯è·å–å’ŒåŒºåˆ†å„ç§ä¸åŒç±»å‹      çˆ¶ç±»å­—æ®µä¿¡æ¯è·å–ä»¥åŠå­ç±»å­—æ®µä¿¡æ¯å¦‚ä½•è·å–      å¯¹è±¡ç¤ºä¾‹æ–¹æ³•ä¿¡æ¯è·å–å’Œæ–¹æ³•æ‰§è¡Œ        è‡ªå®šä¹‰æ³¨è§£çš„ä½¿ç”¨  æµ‹è¯•ç”¨ä¾‹          ä½¿ç”¨äº† testcontainers + docker mongodb + mockmvc ç¼–å†™é›†æˆæµ‹è¯•ç”¨ä¾‹      json æ–‡ä»¶ + MongoTemplate#insert å®Œæˆæµ‹è¯•å‰æ•°æ®å‡†å¤‡      MongoTemplate#dropCollection å®Œæˆæµ‹è¯•åæ•°æ®æ¸…ç†      MockMvc å¯¹äºå“åº”æ•°æ®çš„å„ç§å‡†ç¡®æ€§æ–­è¨€      é‡åˆ°çš„é—®é¢˜  çˆ¶ç±»æ–¹æ³•åå°„è·å–å­ç±»å­—æ®µçš„å–å€¼(å­ç±»å®ä¾‹è°ƒç”¨æ—¶)          è§£å†³ï¼šå¿˜è®°äº† f.setAccessible(true);      æ²¡æœ‰ f.setAccessible(true) çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨è°ƒç”¨åå°„æ–¹æ³• getter + field name çš„æ–¹å¼è·å–å€¼ï¼Œä½†å¾ˆä¸ clean ä¹Ÿä¼šæœ‰æ›´å¤§æ€§èƒ½å¼€é”€ï¼Ÿbenchmark        spring doc openapi å‚æ•°è½¬æ¢å™¨é—®é¢˜          é€šè¿‡ WebMvcConfigurer#addArgumentResolvers è§£å†³      å­˜åœ¨çš„é—®é¢˜åŠå¯ä»¥ç»§ç»­æ”¹è¿›çš„åœ°æ–¹  å…¬ç”¨æŸ¥è¯¢å‚æ•°ç±»åªæ”¯æŒä¸€å±‚ç»§æ‰¿ä½“ç³»ç±»çš„å¤„ç†ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡å®é™…éœ€è¦åšæ”¯æŒå¤„ç†æˆ–åšè§„èŒƒ  å…¬ç”¨æŸ¥è¯¢å‚æ•°ç±»è·å– query æ¡ä»¶çš„æ–¹æ³•ä¸æ•°æ®åº“ç±»å‹ä»¥åŠä¸šåŠ¡å¼ºç»‘å®šï¼Œå¯ä»¥åœ¨è¿™ä¸€å±‚æ ¹æ®å®é™…éœ€æ±‚å†åšä¸€å±‚æŠ½è±¡  ç”±äºä¸šåŠ¡é€»è¾‘ç®€å•ï¼Œæ²¡æœ‰åšå•å…ƒæµ‹è¯•ï¼Œåªåšäº†é›†æˆæµ‹è¯•  åå°„è·å–å­—æ®µä¿¡æ¯æ—¶æ²¡æœ‰åšç¼“å­˜ï¼Œå¯ä»¥ benchmark ä¸‹çœ‹çœ‹å¯¹äºåº”ç”¨çš„æ€§èƒ½æå‡å‚è€ƒåŠç¤ºä¾‹ä»£ç ä»£ç ï¼šcustom_mvc_method_argument_resolverå‚è€ƒï¼šSpring From the Trenches: Creating a Custom HandlerMethodArgumentResolvermvc-ann-methodsoracle-reflect-fieldTypes"
  }
  
]

